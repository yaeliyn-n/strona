<!DOCTYPE html>
<html lang="pl" class="scroll-smooth dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Centrum Wsparcia Kronik Elary. Zgłoś problem, naruszenie regulaminu lub uzyskaj pomoc od naszego zespołu.">
    <meta name="keywords" content="kroniki elary, wsparcie, pomoc, zgłoszenie, problem, regulamin, discord">
    <meta name="author" content="Arcadius & Strażnicy Kronik Elary">
    <title>Kroniki Elary - Utwórz Zgłoszenie Wsparcia</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Lora:ital,wght@0,400;0,500;0,600;0,700;1,400;1,500;1,600&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-primary: #0F172A; 
            --bg-secondary: rgba(30, 41, 59, 0.8); 
            --bg-card: #1E293B; 
            --bg-header: rgba(15, 23, 42, 0.92); 
            
            --text-primary: #E2E8F0; 
            --text-secondary: #94A3B8; 
            --text-accent: #A78BFA; 
            --text-accent-hover: #8B5CF6; 
            
            --border-accent: #8B5CF6; 
            --border-card: rgba(167, 139, 250, 0.25); 
            
            --btn-primary-bg: #8B5CF6; 
            --btn-primary-hover-bg: #7C3AED; 
            --btn-discord-bg: #5865F2;
            --btn-discord-hover-bg: #4752C4;
            
            --scrollbar-thumb-bg: #8B5CF6;
            --scrollbar-thumb-hover-bg: #7C3AED;
            
            --svg-icon-fill: #E2E8F0;
            --shadow-color: rgba(167, 139, 250, 0.25); 
            --shadow-strong-color: rgba(167, 139, 250, 0.4);
            --modal-backdrop: rgba(15, 23, 42, 0.85);

            --rgb-accent: 167, 139, 250;
            --rgb-purple-400: 167, 139, 250; 
            --rgb-stone-400: 168, 162, 158; 
            --rgb-amber-400: 251, 191, 36; 
            --rgb-cyan-400: 34, 211, 238; 

            --text-purple-400: #A78BFA;
            --text-stone-400: #A8A29E;
            --text-amber-400: #FBBF24;
            --text-cyan-400: #22D3EE;
        }

        html.light { 
            --bg-primary: #F9FAFB;
            --bg-secondary: rgba(243, 244, 246, 0.9);
            --bg-card: #FFFFFF;
            --bg-header: rgba(255, 255, 255, 0.95);
            --text-primary: #1F2937;
            --text-secondary: #4B5563;
            --text-accent: #7C3AED;
            --text-accent-hover: #6D28D9;
            --border-accent: #7C3AED;
            --border-card: rgba(124, 58, 237, 0.1);
            --btn-primary-bg: #7C3AED;
            --btn-primary-hover-bg: #6D28D9;
            --btn-discord-bg: #5865F2;
            --btn-discord-hover-bg: #4752C4;
            --scrollbar-thumb-bg: #A78BFA;
            --scrollbar-thumb-hover-bg: #8B5CF6;
            --svg-icon-fill: #374151;
            --shadow-color: rgba(124, 58, 237, 0.08);
            --shadow-strong-color: rgba(124, 58, 237, 0.15);
            --modal-backdrop: rgba(249, 250, 251, 0.85);

            --rgb-accent: 124, 58, 237;
            --rgb-purple-400: 124, 58, 237;
            --rgb-stone-400: 120, 113, 108;
            --rgb-amber-400: 217, 119, 6;
            --rgb-cyan-400: 8, 145, 178;
            --text-purple-400: #7C3AED;
            --text-stone-400: #78716C;
            --text-amber-400: #D97706;
            --text-cyan-400: #0891B2;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-primary);
            color: var(--text-primary);
            transition: background-color 0.3s ease, color 0.3s ease;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            line-height: 1.75; 
        }

        h1, h2, h3, h4, h5 {
            font-family: 'Lora', serif;
            font-weight: 600;
            line-height: 1.35; 
        }
        h1 { letter-spacing: -0.025em; font-weight: 700; }
        h2 { letter-spacing: -0.02em; font-weight: 700; }
        h3 { font-weight: 600; }
        
        .hero-support-bg {
            background: linear-gradient(rgba(15, 23, 42, 0.92), rgba(15, 23, 42, 1)), url('https://placehold.co/1920x700/0a0f1e/a78bfa?text=Centrum+Wsparcia+Kronik') center/cover no-repeat fixed;
        }
        .card-bg {
            background-color: var(--bg-card);
            transition: transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275), box-shadow 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275), background-color 0.3s ease; 
            border: 1px solid var(--border-card); 
            box-shadow: 0 7px 18px -4px var(--shadow-color); 
            overflow: hidden;
        }
        .card-bg:hover {
            transform: translateY(-5px) scale(1.02); 
            box-shadow: 0 12px 24px -6px var(--shadow-strong-color); 
        }
        
        .btn-primary, .btn-discord, .btn-secondary {
            color: #FFFFFF; 
            transition: background-color 0.25s ease, transform 0.25s ease, box-shadow 0.25s ease;
            box-shadow: 0 5px 12px -3px var(--shadow-color);
            font-weight: 600; 
            letter-spacing: 0.03em;
            padding-top: 0.85rem; 
            padding-bottom: 0.85rem;
            border-radius: 0.5rem;
        }
        .btn-primary { background-color: var(--btn-primary-bg); }
        .btn-primary:hover {
            background-color: var(--btn-primary-hover-bg);
            transform: scale(1.06) translateY(-3px); 
            box-shadow: 0 14px 24px -5px var(--shadow-strong-color);
        }
        .btn-discord { background-color: var(--btn-discord-bg); }
        .btn-discord:hover {
            background-color: var(--btn-discord-hover-bg);
            transform: scale(1.06) translateY(-3px);
            box-shadow: 0 10px 20px -5px rgba(88, 101, 242, 0.4);
        }
         .btn-secondary {
            background-color: transparent;
            border: 2px solid var(--border-accent);
            color: var(--text-accent);
            padding: calc(0.85rem - 2px) calc(1.5rem - 2px);
        }
        .btn-secondary:hover {
            background-color: var(--border-accent);
            color: white;
            transform: scale(1.05) translateY(-1px);
            box-shadow: 0 8px 15px -3px var(--shadow-color);
        }
        
        .reveal {
            opacity: 0;
            transform: translateY(70px); 
            transition: opacity 1s cubic-bezier(0.645, 0.045, 0.355, 1), transform 1s cubic-bezier(0.645, 0.045, 0.355, 1);
        }
        .reveal.visible {
            opacity: 1;
            transform: translateY(0);
        }
        ::-webkit-scrollbar { width: 13px; } 
        ::-webkit-scrollbar-track { background: var(--bg-primary); }
        ::-webkit-scrollbar-thumb { background: var(--scrollbar-thumb-bg); border-radius: 7px; border: 3.5px solid var(--bg-primary); }
        ::-webkit-scrollbar-thumb:hover { background: var(--scrollbar-thumb-hover-bg); }
        
        header#navbar {
            background-color: var(--bg-header);
            backdrop-filter: blur(18px); 
            transition: background-color 0.3s ease, box-shadow 0.3s ease;
            box-shadow: 0 5px 15px -4px rgba(15,23,42,0.2); 
        }

        .nav-link {
            position: relative;
            color: var(--text-secondary);
            transition: color 0.2s ease, background-color 0.2s ease, transform 0.2s ease; 
            padding: 0.65rem 1.1rem; 
            border-radius: 0.6rem; 
            font-weight: 500;
        }
        .nav-link:hover {
            transform: translateY(-1px); 
        }
        .nav-link::after { 
            content: '';
            position: absolute;
            width: 0;
            height: 3px; 
            bottom: 5px; 
            left: 50%;
            transform: translateX(-50%);
            background-color: var(--text-accent);
            transition: width 0.35s cubic-bezier(0.25, 0.8, 0.25, 1);
            border-radius: 1.5px;
        }
        .nav-link:hover, .nav-link.active {
            color: var(--text-accent);
            background-color: rgba(var(--rgb-accent), 0.12); 
        }
        .nav-link:hover::after, .nav-link.active::after {
            width: 60%; 
        }
        
        #mobileMenu {
            transition: transform 0.4s cubic-bezier(0.25, 0.8, 0.25, 1), opacity 0.4s cubic-bezier(0.25, 0.8, 0.25, 1);
            transform: translateY(-100%);
            opacity: 0;
            pointer-events: none; 
        }
        #mobileMenu.open {
            transform: translateY(0);
            opacity: 1;
            pointer-events: auto;
        }
        html.dark .text-shadow-custom { 
             text-shadow: 1px 1px 4px rgba(0,0,0,0.6); 
        }
        .user-avatar {
            width: 32px; 
            height: 32px; 
            border-radius: 50%;
            border: 2px solid var(--border-accent);
            cursor: pointer;
            transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
        }
        .user-avatar:hover {
            transform: scale(1.1);
            box-shadow: 0 0 10px var(--shadow-strong-color);
        }
        .dropdown-menu {
            position: absolute;
            top: calc(100% + 0.5rem); 
            right: 0;
            background-color: var(--bg-card);
            border: 1px solid var(--border-card);
            border-radius: 0.5rem; 
            box-shadow: 0 10px 25px -5px var(--shadow-strong-color), 0 8px 10px -6px var(--shadow-color);
            z-index: 50;
            min-width: 200px; 
            opacity: 0;
            visibility: hidden;
            transform: translateY(-10px);
            transition: opacity 0.2s ease, transform 0.2s ease, visibility 0s linear 0.2s;
        }
        .dropdown-menu.open {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
            transition: opacity 0.2s ease, transform 0.2s ease;
        }
        .dropdown-menu a, .dropdown-menu button {
            display: block;
            width: 100%;
            text-align: left;
            padding: 0.75rem 1rem; 
            font-size: 0.875rem; 
            color: var(--text-secondary);
            transition: background-color 0.15s ease, color 0.15s ease;
        }
        .dropdown-menu a:hover, .dropdown-menu button:hover {
            background-color: rgba(var(--rgb-accent), 0.1);
            color: var(--text-accent);
        }
        .dropdown-menu form { margin: 0; } 
        
        .form-input, .form-select, .form-textarea {
            background-color: var(--bg-card); /* Dopasowanie do tła karty */
            border: 1px solid var(--border-card);
            color: var(--text-primary);
            border-radius: 0.375rem; 
            padding: 0.75rem 1rem; 
            width: 100%;
            transition: border-color 0.2s ease, box-shadow 0.2s ease; /* Dodano box-shadow do transition */
        }
        .form-input:focus, .form-select:focus, .form-textarea:focus {
            outline: none;
            border-color: var(--border-accent);
            box-shadow: 0 0 0 3px rgba(var(--rgb-accent), 0.3); /* Lepszy efekt focus */
        }
        .form-label {
            color: var(--text-secondary);
            margin-bottom: 0.5rem; 
            display: block;
            font-weight: 500; 
        }
        .form-file-input {
            background-color: var(--bg-card);
            border: 1px solid var(--border-card);
            color: var(--text-secondary); 
            border-radius: 0.375rem;
            padding: 0.5rem 0.75rem;
            cursor: pointer; /* Dodano kursor */
        }
        .form-file-input::-webkit-file-upload-button { 
            background-color: var(--btn-primary-bg);
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 0.25rem;
            cursor: pointer;
            margin-right: 0.75rem;
            transition: background-color 0.2s ease;
        }
        .form-file-input::-webkit-file-upload-button:hover {
            background-color: var(--btn-primary-hover-bg);
        }
        .form-file-input::file-selector-button { 
             background-color: var(--btn-primary-bg);
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 0.25rem;
            cursor: pointer;
            margin-right: 0.75rem;
            transition: background-color 0.2s ease;
        }
        .form-file-input::file-selector-button:hover {
             background-color: var(--btn-primary-hover-bg);
        }

        #supportFormMessage {
            transition: opacity 0.3s ease, transform 0.3s ease;
            opacity: 0;
            transform: translateY(10px);
        }
        #supportFormMessage.visible {
            opacity: 1;
            transform: translateY(0);
        }
        #supportFormMessage.success { color: #34D399; /* green-400 */ }
        #supportFormMessage.error { color: #F87171; /* red-400 */ }
        .animated-gradient-text {
            background: linear-gradient(45deg, var(--text-accent), var(--text-accent-hover), #c084fc, var(--text-accent));
            background-size: 200% 200%;
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: gradient-flow 8s ease infinite;
        }
        @keyframes gradient-flow {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
    </style>
</head>
<body class="antialiased">

    <header id="navbar" class="fixed top-0 left-0 right-0 z-50 py-3">
        <div class="container mx-auto px-4 sm:px-6 flex justify-between items-center">
            <a href="index.html" class="text-3xl font-bold" aria-label="Strona główna Kronik Elary">
                <span class="text-accent">Kroniki</span> <span class="text-primary">Elary</span>
            </a>
            <nav class="hidden md:flex items-center space-x-1 lg:space-x-2">
                <a href="index.html" class="nav-link">Strona Główna</a>
                <a href="prezentacja.html" class="nav-link">Prezentacja Serwera</a>
                <a href="wikipedia.html" class="nav-link">Wikipedia Kronik</a> 
                <a href="ranking-stats.html" class="nav-link">Rankingi</a>
                <div id="auth-section-nav" class="ml-4 relative">
                    </div>
            </nav>
            <div class="md:hidden flex items-center">
                 <div id="auth-section-mobile-nav" class="mr-2 relative">
                    </div>
                <button id="mobileMenuButton" class="p-2 rounded-md focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-[var(--bg-header)] focus:ring-[var(--text-accent)]" aria-expanded="false" aria-controls="mobileMenu" aria-label="Otwórz menu nawigacyjne">
                    <svg class="w-6 h-6" fill="none" stroke="var(--svg-icon-fill)" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"></path></svg>
                </button>
            </div>
        </div>
        <div id="mobileMenu" class="absolute top-full left-0 right-0 md:hidden shadow-lg" style="background-color: var(--bg-header);">
            <div class="px-2 pt-2 pb-3 space-y-1 sm:px-3">
                <a href="index.html" class="block py-2.5 px-3 nav-link text-base font-medium">Strona Główna</a>
                <a href="prezentacja.html" class="block py-2.5 px-3 nav-link text-base font-medium">Prezentacja Serwera</a>
                <a href="wikipedia.html" class="block py-2.5 px-3 nav-link text-base font-medium">Wikipedia Kronik</a>
                <a href="ranking-stats.html" class="block py-2.5 px-3 nav-link text-base font-medium">Rankingi</a>
                <a href="https://discord.gg/TWOJLINKZAPROSZENIOWY" target="_blank" rel="noopener noreferrer" class="block mt-2 py-2.5 px-3 text-base font-medium text-white bg-purple-600 hover:bg-purple-700 rounded-md text-center">Dołącz do Discorda</a>
            </div>
        </div>
    </header>

    <main>
        <section class="hero-support-bg min-h-[50vh] sm:min-h-[60vh] flex items-center justify-center text-center pt-24 sm:pt-20 reveal">
            <div class="container mx-auto px-4 sm:px-6 py-12 sm:py-16">
                <h1 class="text-4xl sm:text-5xl md:text-6xl font-bold text-white mb-4 leading-tight text-shadow-custom">
                    Centrum Wsparcia <span class="animated-gradient-text">Kronik Elary</span>
                </h1>
                <p class="text-lg sm:text-xl text-slate-200 mb-8 max-w-2xl mx-auto text-shadow-custom">
                    Masz problem, pytanie lub chcesz zgłosić naruszenie? Jesteś we właściwym miejscu. Wypełnij poniższy formularz, a Strażnicy Kronik zajmą się Twoją sprawą.
                </p>
            </div>
        </section>

        <section id="support-form-section" class="py-16 sm:py-24">
            <div class="container mx-auto px-4 sm:px-6">
                <div class="max-w-2xl mx-auto card-bg p-6 sm:p-10 rounded-2xl shadow-xl reveal">
                    <h2 class="text-3xl sm:text-4xl font-bold text-primary mb-8 text-center">Utwórz Nowe Zgłoszenie</h2>
                    
                    <div id="login-prompt" class="hidden text-center mb-6 p-4 bg-amber-500/10 border border-amber-500/30 rounded-lg">
                        <p class="text-amber-300 text-md">
                            Aby wysłać zgłoszenie, <a href="/auth/discord/login" class="font-semibold underline hover:text-amber-200">zaloguj się przez Discord</a>.
                            Dzięki temu będziemy mogli łatwiej się z Tobą skontaktować i śledzić Twoje zgłoszenie.
                        </p>
                    </div>
                    
                    <form id="supportForm" class="space-y-6">
                        <div>
                            <label for="reportType" class="form-label">Rodzaj zgłoszenia:</label>
                            <select id="reportType" name="reportType" class="form-select" required>
                                <option value="" disabled selected>Wybierz rodzaj...</option>
                                <option value="problem_techniczny">Problem techniczny na stronie/bocie</option>
                                <option value="naruszenie_regulaminu">Zgłoszenie naruszenia regulaminu</option>
                                <option value="pytanie_ogolne">Pytanie ogólne dotyczące serwera</option>
                                <option value="sugestia">Sugestia dotycząca serwera/strony</option>
                                <option value="blad_w_lore">Błąd lub nieścisłość w Lore/Wikipedii</option>
                                <option value="inny">Inny rodzaj sprawy</option>
                            </select>
                        </div>

                        <div>
                            <label for="description" class="form-label">Szczegółowy opis sprawy:</label>
                            <textarea id="description" name="description" rows="6" class="form-textarea" placeholder="Opisz dokładnie swój problem, pytanie lub sugestię. Im więcej szczegółów, tym szybciej będziemy mogli pomóc." required></textarea>
                        </div>

                        <div>
                            <label for="attachment" class="form-label">Załącznik (opcjonalnie, max 5MB, tylko obrazy):</label>
                            <input type="file" id="attachment" name="attachment" class="form-file-input w-full text-sm" accept="image/jpeg, image/png, image/gif">
                            <p class="text-xs text-secondary mt-1">Dozwolone formaty: JPG, PNG, GIF. Maksymalny rozmiar: 5MB.</p>
                        </div>
                        
                        <div class="pt-2">
                            <button type="submit" id="submitSupportButton" class="btn-primary w-full py-3 text-lg font-semibold">
                                Wyślij Zgłoszenie
                            </button>
                        </div>
                        <p id="supportFormMessage" class="text-sm text-center mt-4 h-6"></p> </form>
                </div>
            </div>
        </section>
    </main>

    <footer class="py-12 text-center" style="background-color: var(--bg-header);">
        <div class="container mx-auto px-4 sm:px-6">
            <div class="flex justify-center space-x-6 mb-6">
                <a href="#" class="text-secondary hover:text-accent transition-colors duration-200" aria-label="Placeholder Twitter">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24"><path d="M22.46 6c-.77.35-1.6.58-2.46.67.9-.53 1.59-1.37 1.92-2.38-.84.5-1.78.86-2.79 1.07C18.28 4.42 17.03 4 15.64 4c-2.94 0-5.32 2.38-5.32 5.32 0 .42.05.83.14 1.22-4.42-.22-8.33-2.34-10.96-5.55-.46.79-.72 1.7-.72 2.67 0 1.84.94 3.47 2.37 4.42-.87-.03-1.69-.27-2.41-.66v.07c0 2.57 1.83 4.72 4.25 5.21-.44.12-.91.18-1.39.18-.34 0-.67-.03-1-.1 0 .67.65 1.37 1.77 1.84-.7.55-1.59.88-2.58.88-.39 0-.77-.02-1.14-.07.91.59 2 1.02 3.19 1.02 3.83 0 5.93-3.18 5.93-5.93 0-.09 0-.18-.01-.27.41-.3.76-.68 1.04-1.09z"/></svg>
                </a>
                 <a href="#" class="text-secondary hover:text-accent transition-colors duration-200" aria-label="Placeholder Instagram">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2.163c3.204 0 3.584.012 4.85.07 1.17.053 1.805.248 2.227.415.562.217.96.477 1.382.896.419.42.679.819.896 1.381.167.422.362 1.056.415 2.227.058 1.266.07 1.646.07 4.85s-.012 3.584-.07 4.85c-.053 1.17-.248 1.805-.415 2.227a3.48 3.48 0 01-.896 1.382c-.42.419-.82.679-1.382.896-.422.167-1.056.362-2.227.415-1.266.058-1.646.07-4.85.07s-3.584-.012-4.85-.07c-1.17-.053-1.805-.248-2.227-.415a3.492 3.492 0 01-1.381-.896 3.492 3.492 0 01-.896-1.381c-.167-.422-.362-1.056-.415-2.227-.058-1.266-.07-1.646-.07-4.85s.012-3.584.07-4.85c.053-1.17.248-1.805.415-2.227.218-.562.477-.96.896-1.381.419-.42.819-.679 1.381-.896.422-.167 1.056-.362 2.227-.415C8.416 2.175 8.796 2.163 12 2.163zm0 1.802c-3.143 0-3.505.012-4.725.068-1.09.05-1.647.235-1.98.378a1.69 1.69 0 00-.755.755c-.143.333-.328.89-.378 1.98C4.082 8.495 4.07 8.857 4.07 12s.012 3.505.068 4.725c.05 1.09.235 1.647.378 1.98.16.373.397.637.755.755.333.143.89.328 1.98.378 1.22.056 1.582.068 4.725.068s3.505-.012 4.725-.068c1.09-.05 1.647.235 1.98-.378.373-.16.637-.397.755-.755.143-.333.328.89.378-1.98.056-1.22.068-1.582.068-4.725s-.012-3.505-.068-4.725c-.05-1.09-.235-1.647-.378-1.98a1.69 1.69 0 00-.755-.755c-.333-.143-.89-.328-1.98-.378C15.505 3.977 15.143 3.965 12 3.965zm0 3.273a4.762 4.762 0 100 9.524 4.762 4.762 0 000-9.524zm0 7.722a3.06 3.06 0 110-6.12 3.06 3.06 0 010 6.12zm4.758-7.868a1.128 1.128 0 100-2.255 1.128 1.128 0 000 2.255z"/></svg>
                </a>
                 <a href="polityka-prywatnosci.html" class="text-secondary hover:text-accent transition-colors duration-200" aria-label="Polityka Prywatności">
                    Polityka Prywatności
                </a>
            </div>
            <p class="text-secondary text-sm">
                &copy; <span id="currentYear"></span> Kroniki Elary. Wszelkie prawa zastrzeżone.
            </p>
            <p class="text-xs mt-2.5" style="color: var(--text-secondary-light, #94A3B8);">
                Stworzone z pasji do anime i mangi przez Arcadiusa i jego Strażników.
            </p>
        </div>
    </footer>

    <script>
        // Funkcja do obsługi aktywnego linku w nawigacji
        function setActiveNavLink() {
            const currentPage = window.location.pathname.split("/").pop() || "index.html";
            const navLinks = document.querySelectorAll('header nav > a.nav-link, #mobileMenu > div > a.nav-link');
             // Na stronie support.html żaden link nawigacyjny nie jest 'active', chyba że jest to część "Mój Profil"
            navLinks.forEach(link => {
                link.classList.remove('active');
                const linkPage = link.getAttribute('href').split("/").pop() || "index.html";
                 if (linkPage === currentPage) { // Aktywuj jeśli to dokładnie ta strona
                    link.classList.add('active');
                }
            });
        }

        // Funkcja do obsługi wyświetlania informacji o użytkowniku/logowania
        async function updateAuthDisplay() {
            const authSectionNav = document.getElementById('auth-section-nav');
            const authSectionMobileNav = document.getElementById('auth-section-mobile-nav');
            const loginPrompt = document.getElementById('login-prompt');
            const submitSupportButton = document.getElementById('submitSupportButton');
            const ADMIN_DISCORD_ID = "1238814802357387285"; 
            let localLoggedInUser = null; // Zmienna lokalna dla tej funkcji

            function createLoginButton(isMobile = false) {
                const loginButton = document.createElement('a');
                loginButton.href = '/auth/discord/login'; 
                loginButton.id = isMobile ? 'discordLoginButtonMobileNav' : 'discordLoginButtonNav';
                loginButton.className = 'btn-discord !text-white px-4 py-2.5 rounded-md text-sm flex items-center' + (isMobile ? ' w-full justify-center mt-2' : '');
                loginButton.innerHTML = `
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20.297 0H3.703C1.658 0 0 1.658 0 3.703V20.297C0 22.342 1.658 24 3.703 24H20.297C22.342 24 24 22.342 24 20.297V3.703C24 1.658 22.342 0 20.297 0ZM8.107 15.232C7.089 15.232 6.241 14.384 6.241 13.366C6.241 12.348 7.089 11.5 8.107 11.5C9.125 11.5 9.973 12.348 9.973 13.366C9.973 14.384 9.125 15.232 8.107 15.232ZM12.000 11.071C10.982 11.071 10.134 10.223 10.134 9.205C10.134 8.188 10.982 7.339 12.000 7.339C13.018 7.339 13.866 8.188 13.866 9.205C13.866 10.223 13.018 11.071 12.000 11.071ZM15.893 15.232C14.875 15.232 14.027 14.384 14.027 13.366C14.027 12.348 14.875 11.5 15.893 11.5C16.911 11.5 17.759 12.348 17.759 13.366C17.759 14.384 16.911 15.232 15.893 15.232Z"/></svg>
                    Zaloguj przez Discord
                `;
                return loginButton;
            }

            function createAvatarDropdown(user, isMobile = false) {
                const containerId = isMobile ? 'userDropdownContainerMobile' : 'userDropdownContainerNav';
                const dropdownId = isMobile ? 'userDropdownMobile' : 'userDropdownNav';

                const container = document.createElement('div');
                container.id = containerId;
                container.className = 'relative';

                const avatarImg = document.createElement('img');
                avatarImg.src = user.avatar ? `https://cdn.discordapp.com/avatars/${user.id}/${user.avatar}.png?size=32` : 'https://placehold.co/32x32/A78BFA/FFFFFF?text=U';
                avatarImg.alt = 'Awatar użytkownika';
                avatarImg.className = 'user-avatar';
                avatarImg.onclick = (event) => {
                    event.stopPropagation(); 
                    const dropdown = document.getElementById(dropdownId);
                    if (dropdown) dropdown.classList.toggle('open');
                };
                container.appendChild(avatarImg);

                const dropdownMenu = document.createElement('div');
                dropdownMenu.id = dropdownId;
                dropdownMenu.className = 'dropdown-menu';
                
                const profileLink = document.createElement('a');
                profileLink.href = 'profil.html';
                profileLink.textContent = 'Mój Profil';
                dropdownMenu.appendChild(profileLink);

                const supportTicketsLink = document.createElement('a');
                supportTicketsLink.href = 'support.html'; 
                supportTicketsLink.textContent = 'Centrum Wsparcia';
                dropdownMenu.appendChild(supportTicketsLink);

                if (user.id === ADMIN_DISCORD_ID) {
                    const adminLinkElement = document.createElement('a'); 
                    adminLinkElement.href = '/admin.html'; 
                    adminLinkElement.textContent = 'Panel Admina';
                    dropdownMenu.appendChild(adminLinkElement);
                }
                
                const logoutForm = document.createElement('form');
                logoutForm.action = '/auth/logout'; 
                logoutForm.method = 'POST';
                const logoutButton = document.createElement('button');
                logoutButton.type = 'submit';
                logoutButton.textContent = 'Wyloguj';
                logoutForm.appendChild(logoutButton);
                dropdownMenu.appendChild(logoutForm);

                container.appendChild(dropdownMenu);
                return container;
            }

            try {
                const response = await fetch('/api/me'); 
                if (response.ok) {
                    localLoggedInUser = await response.json(); // Przypisz do zmiennej lokalnej
                    if (loginPrompt) loginPrompt.classList.add('hidden');
                    if (submitSupportButton) submitSupportButton.disabled = false;

                    if (authSectionNav) {
                        authSectionNav.innerHTML = ''; 
                        authSectionNav.appendChild(createAvatarDropdown(localLoggedInUser, false));
                    }
                    if (authSectionMobileNav) {
                        authSectionMobileNav.innerHTML = ''; 
                        authSectionMobileNav.appendChild(createAvatarDropdown(localLoggedInUser, true));
                    }
                } else {
                    localLoggedInUser = null;
                    if (loginPrompt) loginPrompt.classList.remove('hidden');
                    if (submitSupportButton) {
                        submitSupportButton.disabled = true;
                        submitSupportButton.textContent = 'Zaloguj się, aby wysłać';
                    }
                     if (authSectionNav) {
                        authSectionNav.innerHTML = '';
                        authSectionNav.appendChild(createLoginButton(false));
                    }
                    if (authSectionMobileNav) {
                        authSectionMobileNav.innerHTML = '';
                        authSectionMobileNav.appendChild(createLoginButton(true));
                    }
                }
            } catch (error) {
                console.error('Błąd aktualizacji UI logowania:', error);
                localLoggedInUser = null;
                if (loginPrompt) loginPrompt.classList.remove('hidden');
                 if (submitSupportButton) {
                    submitSupportButton.disabled = true;
                    submitSupportButton.textContent = 'Błąd logowania';
                }
                 if (authSectionNav) {
                    authSectionNav.innerHTML = '';
                    authSectionNav.appendChild(createLoginButton(false));
                }
                if (authSectionMobileNav) {
                    authSectionMobileNav.innerHTML = '';
                    authSectionMobileNav.appendChild(createLoginButton(true));
                }
            }
            return localLoggedInUser; // Zwróć status użytkownika
        }
        
        function setupMobileMenu() {
            const mobileMenuButton = document.getElementById('mobileMenuButton');
            const mobileMenu = document.getElementById('mobileMenu');
            
            if (mobileMenuButton && mobileMenu) {
                mobileMenuButton.addEventListener('click', () => {
                    const isExpanded = mobileMenuButton.getAttribute('aria-expanded') === 'true' || false;
                    mobileMenuButton.setAttribute('aria-expanded', !isExpanded);
                    mobileMenu.classList.toggle('open');
                });
                mobileMenu.querySelectorAll('a.nav-link').forEach(link => { 
                    link.addEventListener('click', () => {
                        mobileMenuButton.setAttribute('aria-expanded', 'false');
                        mobileMenu.classList.remove('open');
                    });
                });
            }
        }

        function setupRevealAnimations() {
            const revealObserver = new IntersectionObserver((entries, observer) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add('visible');
                        observer.unobserve(entry.target);
                    }
                });
            }, { threshold: 0.05 }); 

            document.querySelectorAll('.reveal').forEach(el => {
                revealObserver.observe(el);
            });
        }

        function setupDropdownDismiss() {
            window.addEventListener('click', function(e) {
                const desktopDropdownContainer = document.getElementById('userDropdownContainerNav');
                const mobileDropdownContainer = document.getElementById('userDropdownContainerMobile');
                const desktopDropdown = document.getElementById('userDropdownNav');
                const mobileDropdown = document.getElementById('userDropdownMobile');

                if (desktopDropdownContainer && !desktopDropdownContainer.contains(e.target) && desktopDropdown) {
                    desktopDropdown.classList.remove('open');
                }
                if (mobileDropdownContainer && !mobileDropdownContainer.contains(e.target) && mobileDropdown) {
                     mobileDropdown.classList.remove('open');
                }
            });
        }

        function setupSupportForm() {
            const supportForm = document.getElementById('supportForm');
            const supportFormMessage = document.getElementById('supportFormMessage');
            const submitSupportButton = document.getElementById('submitSupportButton');
            
            if (supportForm) {
                supportForm.addEventListener('submit', async function(event) {
                    event.preventDefault();
                    const currentUser = await updateAuthDisplay(); // Pobierz aktualny stan użytkownika

                    if (!currentUser) {
                        supportFormMessage.textContent = 'Musisz być zalogowany, aby wysłać zgłoszenie.';
                        supportFormMessage.className = 'text-sm text-center mt-4 error visible';
                        return;
                    }

                    submitSupportButton.disabled = true;
                    submitSupportButton.innerHTML = `
                        <svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-white inline" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                        </svg>
                        Wysyłanie...
                    `;
                    supportFormMessage.textContent = '';
                    supportFormMessage.className = 'text-sm text-center mt-4 h-6'; // Reset i rezerwacja miejsca

                    const formData = new FormData(this);
                    formData.append('discordUserId', currentUser.id);
                    formData.append('discordUsername', currentUser.username);

                    try {
                        const response = await fetch('/api/support/submit', {
                            method: 'POST',
                            body: formData 
                        });
                        const result = await response.json();
                        if (response.ok) {
                            supportFormMessage.textContent = result.message || 'Zgłoszenie wysłane pomyślnie!';
                            supportFormMessage.classList.add('success', 'visible');
                            supportForm.reset();
                            setTimeout(() => {
                                supportFormMessage.textContent = '';
                                supportFormMessage.classList.remove('visible', 'success', 'error');
                            }, 7000); // Dłuższy czas wyświetlania
                        } else {
                            supportFormMessage.textContent = result.error || 'Wystąpił błąd podczas wysyłania zgłoszenia.';
                            supportFormMessage.classList.add('error', 'visible');
                        }
                    } catch (error) {
                        console.error('Błąd wysyłania formularza:', error);
                        supportFormMessage.textContent = 'Wystąpił błąd sieciowy. Spróbuj ponownie później.';
                        supportFormMessage.classList.add('error', 'visible');
                    } finally {
                        if (currentUser) { 
                            submitSupportButton.disabled = false;
                            submitSupportButton.textContent = 'Wyślij Zgłoszenie';
                        }
                    }
                });
            }
        }
        
        document.addEventListener('DOMContentLoaded', async function() {
            document.getElementById('currentYear').textContent = new Date().getFullYear();
            
            if (!document.documentElement.classList.contains('light') && !document.documentElement.classList.contains('dark')) {
                 document.documentElement.classList.add('dark');
            }

            setActiveNavLink();
            await updateAuthDisplay(); // Poczekaj na zakończenie, aby setupSupportForm miał dostęp do statusu logowania
            setupMobileMenu();
            setupRevealAnimations();
            setupDropdownDismiss();
            setupSupportForm(); // Inicjalizuj formularz po sprawdzeniu statusu logowania
        });
    </script>
</body>
</html>
