<!DOCTYPE html>
<html lang="pl" class="scroll-smooth dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Twój osobisty profil w Kronikach Elary. Zobacz swoje statystyki, ekwipunek, osiągnięcia i zarządzaj swoim kontem.">
    <meta name="keywords" content="profil użytkownika, kroniki elary, statystyki gracza, ekwipunek, discord, anime, manga">
    <meta name="author" content="Arcadius & Strażnicy Kronik Elary">
    <title>Mój Profil - Kroniki Elary</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Lora:ital,wght@0,400;0,500;0,600;0,700;1,400;1,500;1,600&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-primary: #0F172A; 
            --bg-secondary: #1E293B; 
            --bg-card: #111827; 
            --bg-header: rgba(15, 23, 42, 0.92); 
            --text-primary: #E2E8F0; 
            --text-secondary: #94A3B8; 
            --text-accent: #A78BFA; 
            --text-accent-hover: #8B5CF6; 
            --border-accent: #8B5CF6;
            --border-card: rgba(167, 139, 250, 0.15); 
            --btn-primary-bg: #8B5CF6;
            --btn-primary-hover-bg: #7C3AED;
            --btn-discord-bg: #5865F2;
            --btn-discord-hover-bg: #4752C4;
            --scrollbar-thumb-bg: #8B5CF6;
            --scrollbar-thumb-hover-bg: #7C3AED;
            --svg-icon-fill: #E2E8F0;
            --shadow-color: rgba(167, 139, 250, 0.15); 
            --shadow-strong-color: rgba(167, 139, 250, 0.3); 
            --modal-backdrop: rgba(15, 23, 42, 0.85);
            --rgb-accent: 167, 139, 250;
            --rgb-purple-400: 167, 139, 250; 
            --rgb-stone-400: 168, 162, 158; 
            --rgb-amber-400: 251, 191, 36; 
            --rgb-cyan-400: 34, 211, 238; 
            --text-purple-400: #A78BFA;
            --text-stone-400: #A8A29E;
            --text-amber-400: #FBBF24;
            --text-cyan-400: #22D3EE;
        }
        html.light {
            --bg-primary: #F9FAFB; 
            --bg-secondary: #F3F4F6; 
            --bg-card: #FFFFFF; 
            --bg-header: rgba(255, 255, 255, 0.95);
            --text-primary: #1F2937; 
            --text-secondary: #4B5563; 
            --text-accent: #7C3AED; 
            --text-accent-hover: #6D28D9; 
            --border-accent: #7C3AED;
            --border-card: rgba(124, 58, 237, 0.1);
            --btn-primary-bg: #7C3AED;
            --btn-primary-hover-bg: #6D28D9;
            --btn-discord-bg: #5865F2;
            --btn-discord-hover-bg: #4752C4;
            --scrollbar-thumb-bg: #A78BFA;
            --scrollbar-thumb-hover-bg: #8B5CF6;
            --svg-icon-fill: #374151;
            --shadow-color: rgba(124, 58, 237, 0.08);
            --shadow-strong-color: rgba(124, 58, 237, 0.15);
            --modal-backdrop: rgba(249, 250, 251, 0.85);
            --rgb-accent: 124, 58, 237;
            --rgb-purple-400: 124, 58, 237;
            --rgb-stone-400: 120, 113, 108;
            --rgb-amber-400: 217, 119, 6;
            --rgb-cyan-400: 8, 145, 178;
            --text-purple-400: #7C3AED;
            --text-stone-400: #78716C;
            --text-amber-400: #D97706;
            --text-cyan-400: #0891B2;
        }
        body { font-family: 'Inter', sans-serif; background-color: var(--bg-primary); color: var(--text-primary); transition: background-color 0.3s ease, color 0.3s ease; -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale; line-height: 1.75; }
        h1, h2, h3, h4, h5 { font-family: 'Lora', serif; font-weight: 600; line-height: 1.35; }
        h1 { letter-spacing: -0.025em; font-weight: 700; } h2 { letter-spacing: -0.02em; font-weight: 700; } h3 { font-weight: 600; }
        .hero-profile-bg { background: linear-gradient(rgba(15, 23, 42, 0.88), rgba(15, 23, 42, 0.98)), url('https://placehold.co/1920x400/0a0f1e/A78BFA?text=Mój+Profil') center/cover no-repeat; }
        .section-bg { background-color: var(--bg-secondary); }
        .card-bg { background-color: var(--bg-card); transition: transform 0.3s cubic-bezier(0.25, 0.1, 0.25, 1), box-shadow 0.3s cubic-bezier(0.25, 0.1, 0.25, 1), background-color 0.3s ease; border: 1px solid var(--border-card); box-shadow: 0 6px 12px -3px var(--shadow-color); overflow: hidden; }
        .card-bg:hover { transform: translateY(-8px) scale(1.02); box-shadow: 0 12px 24px -4px var(--shadow-strong-color); }
        .btn-primary, .btn-discord, .btn-secondary { color: #FFFFFF; transition: background-color 0.2s ease, transform 0.2s ease, box-shadow 0.2s ease; box-shadow: 0 4px 8px -2px var(--shadow-color); font-weight: 600; letter-spacing: 0.03em; padding-top: 0.8rem; padding-bottom: 0.8rem; border-radius: 0.375rem; } 
        .btn-primary { background-color: var(--btn-primary-bg); } .btn-primary:hover { background-color: var(--btn-primary-hover-bg); transform: scale(1.04) translateY(-2px); box-shadow: 0 10px 18px -4px var(--shadow-strong-color); }
        .btn-discord { background-color: var(--btn-discord-bg); } .btn-discord:hover { background-color: var(--btn-discord-hover-bg); transform: scale(1.04) translateY(-2px); box-shadow: 0 10px 18px -4px rgba(88, 101, 242, 0.35); }
        .btn-secondary { background-color: transparent; border: 2px solid var(--border-accent); color: var(--text-accent); padding: calc(0.8rem - 2px) calc(1.5rem - 2px); }
        .btn-secondary:hover { background-color: var(--border-accent); color: white; transform: scale(1.04) translateY(-2px); box-shadow: 0 6px 12px -2px var(--shadow-color); }
        .text-accent { color: var(--text-accent); }
        .reveal { opacity: 0; transform: translateY(50px); transition: opacity 0.8s cubic-bezier(0.645, 0.045, 0.355, 1), transform 0.8s cubic-bezier(0.645, 0.045, 0.355, 1); }
        .reveal.visible { opacity: 1; transform: translateY(0); }
        ::-webkit-scrollbar { width: 12px; } ::-webkit-scrollbar-track { background: var(--bg-primary); }
        ::-webkit-scrollbar-thumb { background: var(--scrollbar-thumb-bg); border-radius: 6px; border: 3px solid var(--bg-primary); }
        ::-webkit-scrollbar-thumb:hover { background: var(--scrollbar-thumb-hover-bg); }
        header#navbar { background-color: var(--bg-header); backdrop-filter: blur(16px); transition: background-color 0.3s ease, box-shadow 0.3s ease; box-shadow: 0 4px 10px -3px rgba(15,23,42,0.15); }
        .nav-link { position: relative; color: var(--text-secondary); transition: color 0.2s ease, background-color 0.2s ease, transform 0.2s ease; padding: 0.6rem 1rem; border-radius: 0.375rem; font-weight: 500; }
        .nav-link:hover { transform: translateY(-1px); }
        .nav-link::after { content: ''; position: absolute; width: 0; height: 2px; bottom: 4px; left: 50%; transform: translateX(-50%); background-color: var(--text-accent); transition: width 0.3s cubic-bezier(0.25, 0.8, 0.25, 1); border-radius: 1px; }
        .nav-link:hover, .nav-link.active { color: var(--text-accent); background-color: rgba(var(--rgb-accent), 0.1); }
        .nav-link:hover::after, .nav-link.active::after { width: 50%; }
        #mobileMenu { transition: transform 0.3s cubic-bezier(0.25, 0.8, 0.25, 1), opacity 0.3s cubic-bezier(0.25, 0.8, 0.25, 1); transform: translateY(-100%); opacity: 0; pointer-events: none; }
        #mobileMenu.open { transform: translateY(0); opacity: 1; pointer-events: auto; }
        html.dark .text-shadow-custom { text-shadow: 1px 1px 3px rgba(0,0,0,0.5); }
        .user-avatar { width: 32px; height: 32px; border-radius: 50%; border: 2px solid var(--border-accent); cursor: pointer; transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out; }
        .user-avatar:hover { transform: scale(1.1); box-shadow: 0 0 8px var(--shadow-strong-color); }
        .dropdown-menu { position: absolute; top: calc(100% + 0.5rem); right: 0; background-color: var(--bg-card); border: 1px solid var(--border-card); border-radius: 0.375rem; box-shadow: 0 8px 20px -4px var(--shadow-strong-color), 0 6px 8px -5px var(--shadow-color); z-index: 50; min-width: 220px; opacity: 0; visibility: hidden; transform: translateY(-8px); transition: opacity 0.15s ease, transform 0.15s ease, visibility 0s linear 0.15s; }
        .dropdown-menu.open { opacity: 1; visibility: visible; transform: translateY(0); transition: opacity 0.15s ease, transform 0.15s ease; }
        .dropdown-menu a, .dropdown-menu button { display: block; width: 100%; text-align: left; padding: 0.7rem 1rem; font-size: 0.875rem; color: var(--text-secondary); transition: background-color 0.1s ease, color 0.1s ease; }
        .dropdown-menu a:hover, .dropdown-menu button:hover { background-color: rgba(var(--rgb-accent), 0.08); color: var(--text-accent); }
        .dropdown-menu form { margin: 0; } 
        .modal { background-color: var(--modal-backdrop); backdrop-filter: blur(6px); }
        .modal-content { background-color: var(--bg-card); max-height: 90vh; }
        
        .profile-avatar-large { width: 128px; height: 128px; border-radius: 50%; border: 4px solid var(--border-accent); box-shadow: 0 0 20px rgba(var(--rgb-accent), 0.4); }
        .stat-card { background-color: var(--bg-secondary); padding: 1.5rem; border-radius: 0.5rem; text-align: center; }
        .stat-value { font-size: 2rem; font-weight: 700; color: var(--text-accent); display: block; }
        .stat-label { font-size: 0.875rem; color: var(--text-secondary); margin-top: 0.25rem; }
        .inventory-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(100px, 1fr)); gap: 1rem; }
        .inventory-item { background-color: var(--bg-secondary); border: 1px solid var(--border-card); border-radius: 0.375rem; padding: 1rem; text-align: center; }
        .inventory-item img { width: 48px; height: 48px; margin: 0 auto 0.5rem auto; object-fit: contain; }
        .inventory-item-name { font-size: 0.875rem; font-weight: 500; color: var(--text-primary); }
        .inventory-item-quantity { font-size: 0.75rem; color: var(--text-accent); }
        .loading-spinner { border-color: var(--text-accent) transparent var(--text-accent) transparent; }

        /* Styles for Missions */
        .mission-card { background-color: var(--bg-secondary); padding: 1rem; border-radius: 0.5rem; border-left: 4px solid var(--border-accent); }
        .mission-progress-bar { width: 100%; background-color: rgba(var(--rgb-accent), 0.1); border-radius: 9999px; height: 0.5rem; margin-top: 0.5rem; overflow: hidden; }
        .mission-progress-fill { height: 100%; background-color: var(--text-accent); border-radius: 9999px; transition: width 0.5s ease-in-out; }
        .mission-status-completed { color: #34D399; } /* green-400 */
        .mission-status-active { color: #FBBF24; } /* amber-400 */
        .mission-status-locked { color: #EF4444; } /* red-500 */

        /* Styles for Achievements */
        .achievement-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); gap: 1rem; }
        .achievement-card { background-color: var(--bg-secondary); border: 1px solid var(--border-card); border-radius: 0.5rem; padding: 1rem; text-align: center; height: 100%; display: flex; flex-direction: column; justify-content: space-between; }
        .achievement-icon { font-size: 2.5rem; margin-bottom: 0.5rem; }
        .achievement-title { font-weight: 600; color: var(--text-primary); font-size: 0.95rem; line-height: 1.2; }
        .achievement-description { font-size: 0.75rem; color: var(--text-secondary); margin-top: 0.25rem; flex-grow: 1; }
        .achievement-date { font-size: 0.65rem; color: var(--text-secondary); margin-top: 0.5rem; }
        .achievement-unlocked { border-color: #34D399; } /* Green border for unlocked */
        .achievement-locked { border-color: #EF4444; opacity: 0.6; } /* Red border for locked, slightly faded */

        /* Styles for Warnings */
        .warnings-list {
            background-color: var(--bg-card);
            border-radius: 0.5rem;
            padding: 1.5rem;
        }
        .warning-item {
            border-bottom: 1px solid var(--border-card);
            padding: 0.75rem 0;
        }
        .warning-item:last-child {
            border-bottom: none;
        }
        .warning-reason {
            font-size: 0.9rem;
            color: var(--text-primary);
        }
        .warning-details {
            font-size: 0.75rem;
            color: var(--text-secondary);
            margin-top: 0.25rem;
        }
    </style>
</head>
<body class="antialiased">

    <header id="navbar" class="fixed top-0 left-0 right-0 z-50 py-3">
        <div class="container mx-auto px-4 sm:px-6 flex justify-between items-center">
            <a href="index.html" class="text-3xl font-bold" aria-label="Strona główna Kronik Elary">
                <span class="text-accent">Kroniki</span> <span class="text-primary">Elary</span>
            </a>
            <nav class="hidden md:flex items-center space-x-1 lg:space-x-2">
                <a href="index.html" class="nav-link">Strona Główna</a>
                <a href="prezentacja.html" class="nav-link">Prezentacja Serwera</a>
                <a href="wikipedia.html" class="nav-link">Wikipedia Kronik</a> 
                <a href="ranking-stats.html" class="nav-link">Rankingi</a>
                <div id="auth-section-nav" class="ml-4 relative">
                    </div>
            </nav>
            <div class="md:hidden flex items-center">
                 <div id="auth-section-mobile-nav" class="mr-2 relative">
                    </div>
                <button id="mobileMenuButton" class="p-2 rounded-md focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-[var(--bg-header)] focus:ring-[var(--text-accent)]" aria-expanded="false" aria-controls="mobileMenu" aria-label="Otwórz menu nawigacyjne">
                    <svg class="w-6 h-6" fill="none" stroke="var(--svg-icon-fill)" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"></path></svg>
                </button>
            </div>
        </div>
        <div id="mobileMenu" class="absolute top-full left-0 right-0 md:hidden shadow-lg" style="background-color: var(--bg-header);">
            <div class="px-2 pt-2 pb-3 space-y-1 sm:px-3">
                <a href="index.html" class="block py-2.5 px-3 nav-link text-base font-medium">Strona Główna</a>
                <a href="prezentacja.html" class="block py-2.5 px-3 nav-link text-base font-medium">Prezentacja Serwera</a>
                <a href="wikipedia.html" class="block py-2.5 px-3 nav-link text-base font-medium">Wikipedia Kronik</a>
                <a href="ranking-stats.html" class="block py-2.5 px-3 nav-link text-base font-medium">Rankingi</a>
                <a href="https://discord.gg/TWOJLINKZAPROSZENIOWY" target="_blank" rel="noopener noreferrer" class="block mt-2 py-2.5 px-3 text-base font-medium text-white bg-purple-600 hover:bg-purple-700 rounded-md text-center">Dołącz do Discorda</a>
                 </div>
        </div>
    </header>

    <main>
        <section class="hero-profile-bg pt-32 pb-16 sm:pt-40 sm:pb-24 text-center reveal">
            <div class="container mx-auto px-4 sm:px-6">
                <img id="profileAvatarLarge" src="https://placehold.co/128x128/A78BFA/FFFFFF?text=U" alt="Awatar użytkownika" class="profile-avatar-large mx-auto mb-6" onerror="this.onerror=null;this.src='https://placehold.co/128x128/A78BFA/FFFFFF?text=U';">
                <h1 id="profileUsername" class="text-3xl sm:text-4xl md:text-5xl font-bold text-white mb-2 leading-tight text-shadow-custom">
                    Ładowanie profilu...
                </h1>
                <p id="profileEmail" class="text-md text-slate-300 mb-8 text-shadow-custom"></p>
                <div id="profileLoadingError" class="hidden text-red-400 bg-red-900/50 p-3 rounded-md max-w-md mx-auto"></div>
            </div>
        </section>

        <section id="profile-details" class="py-16 sm:py-20 reveal">
            <div class="container mx-auto px-4 sm:px-6">
                <div class="mb-12">
                    <h2 class="text-2xl sm:text-3xl font-semibold text-primary mb-6 text-center sm:text-left">Twoje <span class="text-accent">Statystyki</span> w Kronikach</h2>
                    <div id="statsContainer" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-4 sm:gap-6">
                        <div class="text-center py-6 col-span-full">
                            <div class="animate-spin rounded-full h-10 w-10 border-t-2 border-b-2 loading-spinner mx-auto mb-2"></div>
                            <p class="text-secondary">Ładowanie statystyk...</p>
                        </div>
                    </div>
                    <div id="statsLoadingError" class="hidden text-red-400 bg-red-900/50 p-3 rounded-md mt-4"></div>
                </div>

                <div class="mb-12">
                    <h2 class="text-2xl sm:text-3xl font-semibold text-primary mb-6 text-center sm:text-left">Twój <span class="text-accent">Ekwipunek</span></h2>
                    <div id="inventoryContainer" class="inventory-grid">
                        <div class="text-center py-6 col-span-full">
                             <div class="animate-spin rounded-full h-10 w-10 border-t-2 border-b-2 loading-spinner mx-auto mb-2"></div>
                            <p class="text-secondary">Ładowanie ekwipunku...</p>
                        </div>
                    </div>
                    <div id="inventoryLoadingError" class="hidden text-red-400 bg-red-900/50 p-3 rounded-md mt-4"></div>
                </div>

                <div class="mb-12">
                    <h2 class="text-2xl sm:text-3xl font-semibold text-primary mb-6 text-center sm:text-left">Twoje <span class="text-accent">Misje</span></h2>
                    <div id="missionsContainer" class="space-y-4">
                        <div class="text-center py-6">
                            <div class="animate-spin rounded-full h-10 w-10 border-t-2 border-b-2 loading-spinner mx-auto mb-2"></div>
                            <p class="text-secondary">Ładowanie misji...</p>
                        </div>
                    </div>
                    <div id="missionsLoadingError" class="hidden text-red-400 bg-red-900/50 p-3 rounded-md mt-4"></div>
                </div>

                <div class="mb-12">
                    <h2 class="text-2xl sm:text-3xl font-semibold text-primary mb-6 text-center sm:text-left">Twoje <span class="text-accent">Osiągnięcia</span></h2>
                    <div id="achievementsContainer" class="achievement-grid">
                        <div class="text-center py-6 col-span-full">
                            <div class="animate-spin rounded-full h-10 w-10 border-t-2 border-b-2 loading-spinner mx-auto mb-2"></div>
                            <p class="text-secondary">Ładowanie osiągnięć...</p>
                        </div>
                    </div>
                    <div id="achievementsLoadingError" class="hidden text-red-400 bg-red-900/50 p-3 rounded-md mt-4"></div>
                </div>

                <div class="mb-12">
                    <h2 class="text-2xl sm:text-3xl font-semibold text-primary mb-6 text-center sm:text-left">Twoje <span class="text-accent">Ostrzeżenia</span></h2>
                    <div id="warningsContainer" class="warnings-list">
                        <div class="text-center py-6">
                            <div class="animate-spin rounded-full h-10 w-10 border-t-2 border-b-2 loading-spinner mx-auto mb-2"></div>
                            <p class="text-secondary">Ładowanie ostrzeżeń...</p>
                        </div>
                    </div>
                    <div id="warningsLoadingError" class="hidden text-red-400 bg-red-900/50 p-3 rounded-md mt-4"></div>
                </div>
            </div>
        </section>
        
    </main>

    <footer class="py-12 text-center" style="background-color: var(--bg-header);">
        <div class="container mx-auto px-4 sm:px-6">
            <div class="flex justify-center space-x-6 mb-6">
                <a href="#" class="text-secondary hover:text-accent transition-colors duration-200" aria-label="Placeholder Twitter">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24"><path d="M22.46 6c-.77.35-1.6.58-2.46.67.9-.53 1.59-1.37 1.92-2.38-.84.5-1.78.86-2.79 1.07C18.28 4.42 17.03 4 15.64 4c-2.94 0-5.32 2.38-5.32 5.32 0 .42.05.83.14 1.22-4.42-.22-8.33-2.34-10.96-5.55-.46.79-.72 1.7-.72 2.67 0 1.84.94 3.47 2.37 4.42-.87-.03-1.69-.27-2.41-.66v.07c0 2.57 1.83 4.72 4.25 5.21-.44.12-.91.18-1.39.18-.34 0-.67-.03-1-.1 0 .67.65 1.37 1.77 1.84-.7.55-1.59.88-2.58.88-.39 0-.77-.02-1.14-.07.91.59 2 1.02 3.19 1.02 3.83 0 5.93-3.18 5.93-5.93 0-.09 0-.18-.01-.27.41-.3.76-.68 1.04-1.09z"/></svg>
                </a>
                 <a href="#" class="text-secondary hover:text-accent transition-colors duration-200" aria-label="Placeholder Instagram">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2.163c3.204 0 3.584.012 4.85.07 1.17.053 1.805.248 2.227.415.562.217.96.477 1.382.896.419.42.679.819.896 1.381.167.422.362 1.056.415 2.227.058 1.266.07 1.646.07 4.85s-.012 3.584-.07 4.85c-.053 1.17-.248 1.805-.415 2.227a3.48 3.48 0 01-.896 1.382c-.42.419-.82.679-1.382.896-.422.167-1.056.362-2.227.415-1.266.058-1.646.07-4.85.07s-3.584-.012-4.85-.07c-1.17-.053-1.805-.248-2.227-.415a3.492 3.492 0 01-1.381-.896 3.492 3.492 0 01-.896-1.381c-.167-.422-.362-1.056-.415-2.227-.058-1.266-.07-1.646-.07-4.85s.012-3.584.07-4.85c.053-1.17.248-1.805.415-2.227.218-.562.477-.96.896-1.381.419-.42.819-.679 1.381-.896.422-.167 1.056-.362 2.227-.415C8.416 2.175 8.796 2.163 12 2.163zm0 1.802c-3.143 0-3.505.012-4.725.068-1.09.05-1.647.235-1.98.378a1.69 1.69 0 00-.755.755c-.143.333-.328.89-.378 1.98C4.082 8.495 4.07 8.857 4.07 12s.012 3.505.068 4.725c.05 1.09.235 1.647.378 1.98.16.373.397.637.755.755.333.143.89.328 1.98.378 1.22.056 1.582.068 4.725.068s3.505-.012 4.725-.068c1.09-.05 1.647.235 1.98-.378.373-.16.637-.397.755-.755.143-.333.328.89.378-1.98.056-1.22.068-1.582.068-4.725s-.012-3.505-.068-4.725c-.05-1.09-.235-1.647-.378-1.98a1.69 1.69 0 00-.755-.755c-.333-.143-.89-.328-1.98-.378C15.505 3.977 15.143 3.965 12 3.965zm0 3.273a4.762 4.762 0 100 9.524 4.762 4.762 0 000-9.524zm0 7.722a3.06 3.06 0 110-6.12 3.06 3.06 0 010 6.12zm4.758-7.868a1.128 1.128 0 100-2.255 1.128 1.128 0 000 2.255z"/></svg>
                </a>
                 <a href="polityka-prywatnosci.html" class="text-secondary hover:text-accent transition-colors duration-200" aria-label="Polityka Prywatności">
                    Polityka Prywatności
                </a>
            </div>
            <p class="text-secondary text-sm">
                &copy; <span id="currentYear">2024</span> Kroniki Elary. Wszelkie prawa zastrzeżone.
            </p>
            <p class="text-xs mt-2.5" style="color: var(--text-secondary-light, #94A3B8);">
                Stworzone z pasji do anime i mangi przez Arcadiusa i jego Strażników.
            </p>
        </div>
    </footer>

    <div id="eventModal" class="fixed inset-0 z-[60] items-center justify-center hidden p-4 modal">
        </div>

    <script>
        // Funkcja do obsługi aktywnego linku w nawigacji
        function setActiveNavLink() {
            const currentPage = window.location.pathname.split("/").pop() || "index.html";
            const navLinks = document.querySelectorAll('header nav > a.nav-link, #mobileMenu > div > a.nav-link');
            const wikipediaSubPages = ["lore-postaci.html", "systemy-botow.html", "rangi-i-role.html", "lore-aethelgard.html", "komendy.html"];

            navLinks.forEach(link => {
                link.classList.remove('active');
                const linkPage = link.getAttribute('href').split("/").pop() || "index.html";
                
                if (linkPage === currentPage) {
                    link.classList.add('active');
                } else if (linkPage === 'wikipedia.html' && wikipediaSubPages.includes(currentPage)) {
                    link.classList.add('active');
                }
            });
        }

        async function updateAuthDisplay() {
            const authSectionNav = document.getElementById('auth-section-nav');
            const authSectionMobileNav = document.getElementById('auth-section-mobile-nav');
            const mobileMenuLinksContainer = document.querySelector('#mobileMenu > div'); 
            const ADMIN_DISCORD_ID = "1238814802357387285"; // TODO: ZASTĄP RZECZYWISTYM ID ADMINA

            function createLoginButton(isMobile = false) {
                const loginButton = document.createElement('a');
                loginButton.href = '/auth/discord/login'; 
                loginButton.id = isMobile ? 'discordLoginButtonMobileNav' : 'discordLoginButtonNav';
                loginButton.className = 'btn-discord !text-white px-4 py-2.5 rounded-md text-sm flex items-center' + (isMobile ? ' w-full justify-center mt-2' : '');
                loginButton.innerHTML = `<svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 24 24"><path d="M20.297 0H3.703C1.658 0 0 1.658 0 3.703V20.297C0 22.342 1.658 24 3.703 24H20.297C22.342 24 24 22.342 24 20.297V3.703C24 1.658 22.342 0 20.297 0ZM8.107 15.232C7.089 15.232 6.241 14.384 6.241 13.366C6.241 12.348 7.089 11.5 8.107 11.5C9.125 11.5 9.973 12.348 9.973 13.366C9.973 14.384 9.125 15.232 8.107 15.232ZM12.000 11.071C10.982 11.071 10.134 10.223 10.134 9.205C10.134 8.188 10.982 7.339 12.000 7.339C13.018 7.339 13.866 8.188 13.866 9.205C13.866 10.223 13.018 11.071 12.000 11.071ZM15.893 15.232C14.875 15.232 14.027 14.384 14.027 13.366C14.027 12.348 14.875 11.5 15.893 11.5C16.911 11.5 17.759 12.348 17.759 13.366C17.759 14.384 16.911 15.232 15.893 15.232Z"/></svg> Zaloguj przez Discord`;
                return loginButton;
            }

            function createAvatarDropdown(user, isMobile = false) {
                const containerId = isMobile ? 'userDropdownContainerMobile' : 'userDropdownContainerNav';
                const dropdownId = isMobile ? 'userDropdownMobile' : 'userDropdownNav';

                const container = document.createElement('div');
                container.id = containerId;
                container.className = 'relative';

                const avatarImg = document.createElement('img');
                avatarImg.src = user.avatar ? `https://cdn.discordapp.com/avatars/${user.id}/${user.avatar}.png?size=32` : 'https://placehold.co/32x32/A78BFA/FFFFFF?text=U';
                avatarImg.alt = 'Awatar użytkownika';
                avatarImg.className = 'user-avatar';
                avatarImg.onerror = () => { avatarImg.src = 'https://placehold.co/32x32/A78BFA/FFFFFF?text=U'; };
                avatarImg.onclick = (event) => {
                    event.stopPropagation(); 
                    const dropdown = document.getElementById(dropdownId);
                    if (dropdown) dropdown.classList.toggle('open');
                };
                container.appendChild(avatarImg);

                const dropdownMenu = document.createElement('div');
                dropdownMenu.id = dropdownId;
                dropdownMenu.className = 'dropdown-menu';
                
                const profileLink = document.createElement('a');
                profileLink.href = 'profil.html';
                profileLink.textContent = 'Mój Profil';
                dropdownMenu.appendChild(profileLink);

                const botShopLink = document.createElement('a');
                botShopLink.href = '/sklep-bota'; 
                botShopLink.textContent = 'Sklep Bota (Dukaty)';
                dropdownMenu.appendChild(botShopLink);
                
                const premiumShopLink = document.createElement('a');
                premiumShopLink.href = 'sklep-premium.html';
                premiumShopLink.textContent = 'Sklep Premium (Kryształy)';
                dropdownMenu.appendChild(premiumShopLink);

                const supportTicketsLink = document.createElement('a');
                supportTicketsLink.href = 'support.html'; 
                supportTicketsLink.textContent = 'Centrum Wsparcia';
                dropdownMenu.appendChild(supportTicketsLink);

                if (user.id === ADMIN_DISCORD_ID) {
                    const adminLinkElement = document.createElement('a'); 
                    adminLinkElement.href = 'admin.html'; 
                    adminLinkElement.textContent = 'Panel Admina';
                    dropdownMenu.appendChild(adminLinkElement);
                }
                
                const logoutForm = document.createElement('form');
                logoutForm.action = '/auth/logout'; 
                logoutForm.method = 'POST';
                const logoutButton = document.createElement('button');
                logoutButton.type = 'submit';
                logoutButton.textContent = 'Wyloguj';
                logoutForm.appendChild(logoutButton);
                dropdownMenu.appendChild(logoutForm);

                container.appendChild(dropdownMenu);
                return container;
            }
            
            if (mobileMenuLinksContainer) {
                const existingMobileAuthElements = mobileMenuLinksContainer.querySelectorAll('#discordLoginButtonMobileNav, #userDropdownContainerMobileMenu, .mobile-auth-item');
                existingMobileAuthElements.forEach(el => el.remove());
            }

            try {
                const response = await fetch('/api/me'); 
                if (response.ok) {
                    const user = await response.json();
                    if (authSectionNav) {
                        authSectionNav.innerHTML = ''; 
                        authSectionNav.appendChild(createAvatarDropdown(user, false));
                    }
                    if (authSectionMobileNav) { 
                        authSectionMobileNav.innerHTML = ''; 
                        authSectionMobileNav.appendChild(createAvatarDropdown(user, true));
                    }
                     if (mobileMenuLinksContainer) {
                        const mobileDropdownContainer = createAvatarDropdown(user, true); 
                        mobileDropdownContainer.id = 'userDropdownContainerMobileMenu';
                        mobileDropdownContainer.classList.add('mt-2', 'border-t', 'border-[var(--border-card)]', 'pt-2', 'mobile-auth-item');
                        
                        const mobileAvatar = mobileDropdownContainer.querySelector('.user-avatar');
                        const mobileDropdown = mobileDropdownContainer.querySelector('.dropdown-menu');
                        
                        if (mobileAvatar) mobileAvatar.classList.add('hidden'); 
                        if (mobileDropdown) {
                            mobileDropdown.classList.remove('absolute', 'top-full', 'right-0', 'dropdown-menu'); 
                            mobileDropdown.classList.add('space-y-1');
                            Array.from(mobileDropdown.children).forEach(child => {
                                child.classList.add('block', 'py-2', 'px-3', 'text-base', 'font-medium', 'rounded-md', 'hover:bg-[rgba(var(--rgb-accent),0.1)]', 'hover:text-[var(--text-accent)]');
                                mobileMenuLinksContainer.appendChild(child);
                            });
                        }
                    }
                     // Po pomyślnym załadowaniu danych użytkownika, załaduj jego statystyki i ekwipunek
                    if (user && user.id) {
                        loadUserStats(user.id);
                        loadUserInventory(user.id);
                        
                        // Użyj tutaj RZECZYWISTEGO ID swojego serwera Discord
                        const GUILD_ID = "1375477258172502086"; 
                        
                        // Sprawdzenie, czy GUILD_ID jest poprawnie ustawione
                        if (!GUILD_ID || !/^\d+$/.test(GUILD_ID)) {
                            document.getElementById('missionsLoadingError').innerHTML = '<p class="text-center text-red-400 py-6">Błąd konfiguracji: ID serwera (GUILD_ID) jest nieprawidłowe. Upewnij się, że jest ustawione w kodzie profil.html.</p>';
                            document.getElementById('missionsLoadingError').classList.remove('hidden');
                            document.getElementById('achievementsLoadingError').innerHTML = '<p class="text-center text-red-400 col-span-full py-6">Błąd konfiguracji: ID serwera (GUILD_ID) jest nieprawidłowe. Upewnij się, że jest ustawione w kodzie profil.html.</p>';
                            document.getElementById('achievementsLoadingError').classList.remove('hidden');
                            document.getElementById('warningsLoadingError').innerHTML = '<p class="text-center text-red-400 py-6">Błąd konfiguracji: ID serwera (GUILD_ID) jest nieprawidłowe. Upewnij się, że jest ustawione w kodzie profil.html.</p>';
                            document.getElementById('warningsLoadingError').classList.remove('hidden');
                            console.error("Błąd: GUILD_ID jest nieprawidłowe. Sprawdź profil.html.");
                        } else {
                            console.log(`Ładowanie danych dla użytkownika ${user.id} na serwerze ${GUILD_ID}`);
                            loadUserMissions(user.id, GUILD_ID); 
                            loadUserAchievements(user.id, GUILD_ID); 
                            loadUserWarnings(user.id, GUILD_ID); 
                        }

                        document.getElementById('profileUsername').textContent = user.username || 'Brak nazwy użytkownika';
                        document.getElementById('profileEmail').textContent = user.email || 'Brak adresu email';
                        const largeAvatar = document.getElementById('profileAvatarLarge');
                        if (largeAvatar) {
                            largeAvatar.src = user.avatar ? `https://cdn.discordapp.com/avatars/${user.id}/${user.avatar}.png?size=128` : 'https://placehold.co/128x128/A78BFA/FFFFFF?text=U';
                            largeAvatar.onerror = () => { largeAvatar.src = 'https://placehold.co/128x128/A78BFA/FFFFFF?text=U'; };
                        }
                    }

                } else {
                     if (authSectionNav) {
                        authSectionNav.innerHTML = '';
                        authSectionNav.appendChild(createLoginButton(false));
                    }
                    if (authSectionMobileNav) { 
                        authSectionMobileNav.innerHTML = '';
                        authSectionMobileNav.appendChild(createLoginButton(true)); 
                    }
                    if (mobileMenuLinksContainer) {
                        const mobileLoginButton = createLoginButton(true); 
                        mobileLoginButton.classList.add('mt-2', 'border-t', 'border-[var(--border-card)]', 'pt-2', 'mobile-auth-item');
                        mobileMenuLinksContainer.appendChild(mobileLoginButton);
                    }
                    // Jeśli użytkownik nie jest zalogowany, wyświetl komunikat
                    document.getElementById('profileUsername').textContent = 'Nie jesteś zalogowany';
                    document.getElementById('profileEmail').textContent = 'Zaloguj się, aby zobaczyć swój profil.';
                    document.getElementById('statsContainer').innerHTML = '<p class="text-center text-secondary col-span-full py-6">Zaloguj się, aby zobaczyć swoje statystyki.</p>';
                    document.getElementById('inventoryContainer').innerHTML = '<p class="text-center text-secondary col-span-full py-6">Zaloguj się, aby zobaczyć swój ekwipunek.</p>';
                    document.getElementById('missionsContainer').innerHTML = '<p class="text-center text-secondary py-6">Zaloguj się, aby zobaczyć swoje misje.</p>';
                    document.getElementById('achievementsContainer').innerHTML = '<p class="text-center text-secondary col-span-full py-6">Zaloguj się, aby zobaczyć swoje osiągnięcia.</p>';
                    document.getElementById('warningsContainer').innerHTML = '<p class="text-center text-secondary py-6">Zaloguj się, aby zobaczyć swoje ostrzeżenia.</p>'; 
                }
            } catch (error) {
                console.error('Błąd aktualizacji UI logowania:', error);
                 if (authSectionNav) {
                    authSectionNav.innerHTML = '';
                    authSectionNav.appendChild(createLoginButton(false));
                }
                if (authSectionMobileNav) {
                    authSectionMobileNav.innerHTML = '';
                    authSectionMobileNav.appendChild(createLoginButton(true));
                }
                if (mobileMenuLinksContainer) {
                    const mobileLoginButton = createLoginButton(true);
                    mobileLoginButton.classList.add('mt-2', 'border-t', 'border-[var(--border-card)]', 'pt-2', 'mobile-auth-item');
                    mobileMenuLinksContainer.appendChild(mobileLoginButton);
                }
                 document.getElementById('profileUsername').textContent = 'Błąd ładowania profilu';
                 document.getElementById('profileLoadingError').textContent = 'Nie udało się załadować danych profilu. Spróbuj odświeżyć stronę.';
                 document.getElementById('profileLoadingError').classList.remove('hidden');
            }
        }
        
        async function loadUserStats(discordUserId) {
            const statsContainer = document.getElementById('statsContainer');
            const statsErrorContainer = document.getElementById('statsLoadingError');
            statsContainer.innerHTML = `
                <div class="text-center py-6 col-span-full">
                    <div class="animate-spin rounded-full h-10 w-10 border-t-2 border-b-2 loading-spinner mx-auto mb-2"></div>
                    <p class="text-secondary">Ładowanie statystyk...</p>
                </div>`;
            statsErrorContainer.classList.add('hidden');

            try {
                const response = await fetch(`/api/bot-stats/${discordUserId}`);
                if (!response.ok) {
                    const errorData = await response.json().catch(() => ({error: 'Nieznany błąd serwera'}));
                    throw new Error(`Błąd serwera: ${response.status} - ${errorData.error || response.statusText}`);
                }
                const stats = await response.json();

                if (stats && !stats.error) {
                    statsContainer.innerHTML = `
                        <div class="stat-card reveal">
                            <span class="stat-value">${stats.xp || 0}</span>
                            <span class="stat-label">Punktów Doświadczenia</span>
                        </div>
                        <div class="stat-card reveal" style="transition-delay: 0.05s;">
                            <span class="stat-value">${stats.level || 0}</span>
                            <span class="stat-label">Poziom</span>
                        </div>
                        <div class="stat-card reveal" style="transition-delay: 0.1s;">
                            <span class="stat-value">${stats.currency || 0}</span>
                            <span class="stat-label">Gwiezdnych Dukatów</span>
                        </div>
                        <div class="stat-card reveal" style="transition-delay: 0.15s;">
                            <span class="stat-value">${stats.premium_currency || 0}</span>
                            <span class="stat-label">Kryształów Elary</span>
                        </div>
                        <div class="stat-card reveal" style="transition-delay: 0.2s;">
                            <span class="stat-value">${stats.message_count || 0}</span>
                            <span class="stat-label">Wysłanych Wiadomości</span>
                        </div>
                        <div class="stat-card reveal" style="transition-delay: 0.25s;">
                            <span class="stat-value">${(stats.voice_time_seconds / 60 || 0).toFixed(0)}</span>
                            <span class="stat-label">Minut na Głosowych</span>
                        </div>
                        <div class="stat-card reveal" style="transition-delay: 0.3s;">
                            <span class="stat-value">${stats.current_streak_days || 0}</span>
                            <span class="stat-label">Dni Streaka</span>
                        </div>
                        <div class="stat-card reveal" style="transition-delay: 0.35s;">
                            <span class="stat-value">${stats.reaction_count || 0}</span>
                            <span class="stat-label">Dodanych Reakcji</span>
                        </div>
                    `;
                     // Ponownie zainicjuj animacje dla nowo dodanych elementów
                    document.querySelectorAll('#statsContainer .reveal').forEach(el => {
                        // Prosta implementacja, można by użyć IntersectionObserver jeśli już jest
                        setTimeout(() => el.classList.add('visible'), 10); 
                    });

                } else {
                    statsContainer.innerHTML = `<p class="text-center text-secondary col-span-full py-6">${stats.error || 'Nie udało się załadować statystyk.'}</p>`;
                }
            } catch (error) {
                console.error('Błąd ładowania statystyk użytkownika:', error);
                statsErrorContainer.textContent = `Nie udało się załadować statystyk. ${error.message}. Spróbuj odświeżyć stronę.`;
                statsErrorContainer.classList.remove('hidden');
                statsContainer.innerHTML = `<p class="text-center text-red-400 col-span-full py-6">Błąd ładowania statystyk.</p>`;
            }
        }

        async function loadUserInventory(discordUserId) {
            const inventoryContainer = document.getElementById('inventoryContainer');
            const inventoryErrorContainer = document.getElementById('inventoryLoadingError');
            inventoryContainer.innerHTML = `
                <div class="text-center py-6 col-span-full">
                    <div class="animate-spin rounded-full h-10 w-10 border-t-2 border-b-2 loading-spinner mx-auto mb-2"></div>
                    <p class="text-secondary">Ładowanie ekwipunku...</p>
                </div>`;
            inventoryErrorContainer.classList.add('hidden');
            
            try {
                const response = await fetch(`/api/bot-inventory/${discordUserId}`);
                if (!response.ok) {
                    const errorData = await response.json().catch(() => ({error: 'Nieznany błąd serwera'}));
                    throw new Error(`Błąd serwera: ${response.status} - ${errorData.error || response.statusText}`);
                }
                const inventory = await response.json();

                if (inventory && inventory.length > 0) {
                    inventoryContainer.innerHTML = inventory.map((item, index) => {
                        const remainingTime = item.expiration_timestamp ? Math.max(0, item.expiration_timestamp - Math.floor(Date.now() / 1000)) : null;
                        const timeString = remainingTime !== null ? formatDuration(remainingTime) : 'Stały';
                        return `
                            <div class="inventory-item reveal" style="transition-delay: ${index * 0.05}s;">
                                <img src="${item.emoji || 'https://placehold.co/64x64/1E293B/A78BFA?text=?'}" alt="${item.name}" onerror="this.onerror=null;this.src='https://placehold.co/64x64/1E293B/A78BFA?text=?';">
                                <p class="inventory-item-name">${item.name}</p>
                                <p class="inventory-item-quantity">Typ: ${item.type}</p>
                                <p class="inventory-item-quantity">Trwanie: ${timeString}</p>
                            </div>
                        `;
                    }).join('');
                    // Ponownie zainicjuj animacje dla nowo dodanych elementów
                     document.querySelectorAll('#inventoryContainer .reveal').forEach(el => {
                        setTimeout(() => el.classList.add('visible'), 10);
                    });
                } else if (inventory && inventory.length === 0) {
                     inventoryContainer.innerHTML = '<p class="text-center text-secondary col-span-full py-6">Twój ekwipunek jest pusty.</p>';
                } 
                else {
                    inventoryContainer.innerHTML = `<p class="text-center text-secondary col-span-full py-6">${inventory.error || 'Nie udało się załadować ekwipunku.'}</p>`;
                }
            } catch (error) {
                console.error('Błąd ładowania ekwipunku użytkownika:', error);
                inventoryErrorContainer.textContent = `Nie udało się załadować ekwipunku. ${error.message}. Spróbuj odświeżyć stronę.`;
                inventoryErrorContainer.classList.remove('hidden');
                inventoryContainer.innerHTML = `<p class="text-center text-red-400 col-span-full py-6">Błąd ładowania ekwipunku.</p>`;
            }
        }

        async function loadUserMissions(discordUserId, guildId) {
            const missionsContainer = document.getElementById('missionsContainer');
            const missionsErrorContainer = document.getElementById('missionsLoadingError');
            missionsContainer.innerHTML = `
                <div class="text-center py-6">
                    <div class="animate-spin rounded-full h-10 w-10 border-t-2 border-b-2 loading-spinner mx-auto mb-2"></div>
                    <p class="text-secondary">Ładowanie misji...</p>
                </div>`;
            missionsErrorContainer.classList.add('hidden');

            if (!guildId || !/^\d+$/.test(guildId)) {
                missionsContainer.innerHTML = '<p class="text-center text-red-400 py-6">Błąd: ID serwera do pobrania misji jest nieprawidłowe. Upewnij się, że ID serwera jest ustawione w kodzie profil.html.</p>';
                console.error("Błąd: GUILD_ID jest nieprawidłowe dla misji. Sprawdź profil.html.");
                return;
            }

            try {
                // Ładowanie aktywnych misji
                const activeMissionsResponse = await fetch(`/api/missions/progress/${guildId}/${discordUserId}`);
                console.log(`Odpowiedź API dla aktywnych misji (status ${activeMissionsResponse.status}):`, await activeMissionsResponse.clone().text());
                if (!activeMissionsResponse.ok) {
                    const errorData = await activeMissionsResponse.json().catch(() => ({error: 'Nieznany błąd serwera'}));
                    throw new Error(`Błąd serwera (aktywne misje): ${activeMissionsResponse.status} - ${errorData.error || activeMissionsResponse.statusText}`);
                }
                const activeMissionsData = await activeMissionsResponse.json();

                // Ładowanie ukończonych misji
                const completedMissionsResponse = await fetch(`/api/missions/completed/${guildId}/${discordUserId}`);
                console.log(`Odpowiedź API dla ukończonych misji (status ${completedMissionsResponse.status}):`, await completedMissionsResponse.clone().text());
                if (!completedMissionsResponse.ok) {
                    const errorData = await completedMissionsResponse.json().catch(() => ({error: 'Nieznany błąd serwera'}));
                    throw new Error(`Błąd serwera (ukończone misje): ${completedMissionsResponse.status} - ${errorData.error || completedMissionsResponse.statusText}`);
                }
                const completedMissionsData = await completedMissionsResponse.json();

                let missionsHtml = '';

                // Wyświetlanie aktywnych misji
                if (activeMissionsData && activeMissionsData.missions_progress && activeMissionsData.missions_progress.length > 0) {
                    missionsHtml += '<h3 class="text-xl font-semibold text-primary mb-4">Aktywne Misje</h3>';
                    missionsHtml += activeMissionsData.missions_progress.map((mission, index) => {
                        const progress = mission.warunki_postep[0]; // Assuming one condition per mission for simplicity
                        const current = progress.aktualna_wartosc;
                        const required = progress.wymagana_wartosc;
                        const percentage = required > 0 ? (current / required) * 100 : 100;
                        const statusClass = mission.status === 'ukonczona_w_cyklu' || mission.status === 'ukonczona_jednorazowa' ? 'mission-status-completed' : 'mission-status-active';
                        const statusText = mission.status === 'ukonczona_w_cyklu' ? 'Ukończono (w tym cyklu)' : (mission.status === 'ukonczona_jednorazowa' ? 'Ukończono' : 'Aktywna');

                        return `
                            <div class="mission-card reveal ${statusClass}" style="transition-delay: ${index * 0.05}s;">
                                <div class="flex justify-between items-center mb-2">
                                    <h4 class="text-lg font-semibold text-primary">${mission.ikona} ${mission.nazwa}</h4>
                                    <span class="text-xs font-medium ${statusClass}">${statusText}</span>
                                </div>
                                <p class="text-sm text-secondary mb-2">${mission.opis}</p>
                                <div class="text-xs text-secondary mb-1">Postęp: ${current}/${required}</div>
                                <div class="mission-progress-bar">
                                    <div class="mission-progress-fill" style="width: ${percentage}%;"></div>
                                </div>
                                <div class="text-xs text-secondary mt-1">Nagrody: ${Object.entries(mission.nagrody).map(([key, val]) => `${val} ${key.replace('_', ' ')}`).join(', ')}</div>
                            </div>
                        `;
                    }).join('');
                } else {
                    missionsHtml += '<p class="text-center text-secondary py-6">Brak aktywnych misji.</p>';
                }

                // Wyświetlanie ukończonych misji
                if (completedMissionsData && completedMissionsData.completed_missions && completedMissionsData.completed_missions.length > 0) {
                    missionsHtml += '<h3 class="text-xl font-semibold text-primary mt-8 mb-4">Ukończone Misje</h3>';
                    missionsHtml += completedMissionsData.completed_missions.map((mission, index) => {
                        const completedDate = mission.completed_at_utc ? new Date(mission.completed_at_utc).toLocaleDateString('pl-PL') : 'Brak daty';
                        return `
                            <div class="mission-card reveal mission-status-completed" style="transition-delay: ${index * 0.05}s;">
                                <div class="flex justify-between items-center mb-2">
                                    <h4 class="text-lg font-semibold text-primary">${mission.icon} ${mission.name}</h4>
                                    <span class="text-xs font-medium mission-status-completed">Ukończono</span>
                                </div>
                                <p class="text-sm text-secondary mb-2">${mission.description}</p>
                                <div class="text-xs text-secondary mt-1">Ukończono: ${completedDate}</div>
                            </div>
                        `;
                    }).join('');
                } else {
                    missionsHtml += '<p class="text-center text-secondary py-6">Brak ukończonych misji.</p>';
                }

                missionsContainer.innerHTML = missionsHtml;
                document.querySelectorAll('#missionsContainer .reveal').forEach(el => {
                    setTimeout(() => el.classList.add('visible'), 10);
                });

            } catch (error) {
                console.error('Błąd ładowania misji użytkownika:', error);
                missionsErrorContainer.textContent = `Nie udało się załadować misji. ${error.message}. Spróbuj odświeżyć stronę.`;
                missionsErrorContainer.classList.remove('hidden');
                missionsContainer.innerHTML = `<p class="text-center text-red-400 py-6">Błąd ładowania misji.</p>`;
            }
        }

        async function loadUserAchievements(discordUserId, guildId) {
            const achievementsContainer = document.getElementById('achievementsContainer');
            const achievementsErrorContainer = document.getElementById('achievementsLoadingError');
            achievementsContainer.innerHTML = `
                <div class="text-center py-6 col-span-full">
                    <div class="animate-spin rounded-full h-10 w-10 border-t-2 border-b-2 loading-spinner mx-auto mb-2"></div>
                    <p class="text-secondary">Ładowanie osiągnięć...</p>
                </div>`;
            achievementsErrorContainer.classList.add('hidden');

            if (!guildId || !/^\d+$/.test(guildId)) {
                achievementsContainer.innerHTML = '<p class="text-center text-red-400 col-span-full py-6">Błąd: ID serwera do pobrania osiągnięć jest nieprawidłowe. Upewnij się, że ID serwera jest ustawione w kodzie profil.html.</p>';
                console.error("Błąd: GUILD_ID jest nieprawidłowe dla osiągnięć. Sprawdź profil.html.");
                return;
            }

            try {
                const response = await fetch(`/api/user_achievements/${guildId}/${discordUserId}`); 
                console.log(`Odpowiedź API dla osiągnięć (status ${response.status}):`, await response.clone().text());
                if (!response.ok) {
                    const errorData = await response.json().catch(() => ({error: 'Nieznany błąd serwera'}));
                    throw new Error(`Błąd serwera: ${response.status} - ${errorData.error || response.statusText}`);
                }
                const data = await response.json();

                if (data && data.achievements && data.achievements.length > 0) {
                    achievementsContainer.innerHTML = data.achievements.map((ach, index) => {
                        const isUnlocked = ach.unlocked;
                        const cardClass = isUnlocked ? 'achievement-unlocked' : 'achievement-locked';
                        const dateText = isUnlocked && ach.unlocked_at ? new Date(ach.unlocked_at).toLocaleDateString('pl-PL') : 'Zablokowane';
                        
                        // Obliczanie postępu
                        let progressText = '';
                        if (!isUnlocked && ach.progress !== null && ach.required_value !== null && !ach.hidden) {
                            progressText = `Postęp: ${ach.progress}/${ach.required_value}`;
                        } else if (!isUnlocked && ach.hidden) {
                            progressText = 'Ukryte osiągnięcie';
                        }


                        return `
                            <div class="achievement-card reveal ${cardClass}" style="transition-delay: ${index * 0.05}s;">
                                <div class="text-center">
                                    <div class="achievement-icon">${ach.icon}</div>
                                    <h3 class="achievement-title">${ach.name}</h3>
                                    <p class="achievement-description">${ach.description}</p>
                                </div>
                                <p class="achievement-date">${dateText}</p>
                                ${progressText ? `<p class="text-xs text-secondary mt-1">${progressText}</p>` : ''}
                            </div>
                        `;
                    }).join('');
                    document.querySelectorAll('#achievementsContainer .reveal').forEach(el => {
                        setTimeout(() => el.classList.add('visible'), 10);
                    });
                } else if (data && data.achievements && data.achievements.length === 0) {
                    achievementsContainer.innerHTML = '<p class="text-center text-secondary col-span-full py-6">Brak zdobytych osiągnięć.</p>';
                } else {
                    achievementsContainer.innerHTML = `<p class="text-center text-secondary col-span-full py-6">${data.error || 'Nie udało się załadować osiągnięć.'}</p>`;
                }
            } catch (error) {
                console.error('Błąd ładowania osiągnięć użytkownika:', error);
                achievementsErrorContainer.textContent = `Nie udało się załadować osiągnięć. ${error.message}. Spróbuj odświeżyć stronę.`;
                achievementsErrorContainer.classList.remove('hidden');
                achievementsContainer.innerHTML = `<p class="text-center text-red-400 col-span-full py-6">Błąd ładowania osiągnięć.</p>`;
            }
        }

        async function loadUserWarnings(discordUserId, guildId) {
            const warningsContainer = document.getElementById('warningsContainer');
            const warningsErrorContainer = document.getElementById('warningsLoadingError');
            warningsContainer.innerHTML = `
                <div class="text-center py-6">
                    <div class="animate-spin rounded-full h-10 w-10 border-t-2 border-b-2 loading-spinner mx-auto mb-2"></div>
                    <p class="text-secondary">Ładowanie ostrzeżeń...</p>
                </div>`;
            warningsErrorContainer.classList.add('hidden');

            if (!guildId || !/^\d+$/.test(guildId)) {
                warningsContainer.innerHTML = '<p class="text-center text-red-400 py-6">Błąd: ID serwera do pobrania ostrzeżeń jest nieprawidłowe. Upewnij się, że ID serwera jest ustawione w kodzie profil.html.</p>';
                console.error("Błąd: GUILD_ID jest nieprawidłowe dla ostrzeżeń. Sprawdź profil.html.");
                return;
            }

            try {
                const response = await fetch(`/api/warnings/list/${guildId}/${discordUserId}`);
                console.log(`Odpowiedź API dla ostrzeżeń (status ${response.status}):`, await response.clone().text());
                if (!response.ok) {
                    const errorData = await response.json().catch(() => ({error: 'Nieznany błąd serwera'}));
                    throw new Error(`Błąd serwera: ${response.status} - ${errorData.error || response.statusText}`);
                }
                const data = await response.json();

                if (data && data.warnings && data.warnings.length > 0) {
                    warningsContainer.innerHTML = data.warnings.map((warning, index) => {
                        const warnDate = warning.created_at_utc ? new Date(warning.created_at_utc).toLocaleDateString('pl-PL', { year: 'numeric', month: 'long', day: 'numeric', hour: '2-digit', minute: '2-digit' }) : 'Brak daty';
                        return `
                            <div class="warning-item reveal" style="transition-delay: ${index * 0.05}s;">
                                <p class="warning-reason"><strong>Powód:</strong> ${warning.reason}</p>
                                <p class="warning-details">Przez: ${warning.moderator_username} (ID: ${warning.moderator_id}) | Data: ${warnDate}</p>
                            </div>
                        `;
                    }).join('');
                    document.querySelectorAll('#warningsContainer .reveal').forEach(el => {
                        setTimeout(() => el.classList.add('visible'), 10);
                    });
                } else if (data && data.warnings && data.warnings.length === 0) {
                    warningsContainer.innerHTML = '<p class="text-center text-secondary py-6">Brak ostrzeżeń dla tego użytkownika.</p>';
                } else {
                    warningsContainer.innerHTML = `<p class="text-center text-secondary py-6">${data.error || 'Nie udało się załadować ostrzeżeń.'}</p>`;
                }
            } catch (error) {
                console.error('Błąd ładowania ostrzeżeń użytkownika:', error);
                warningsErrorContainer.textContent = `Nie udało się załadować ostrzeżeń. ${error.message}. Spróbuj odświeżyć stronę.`;
                warningsErrorContainer.classList.remove('hidden');
                warningsContainer.innerHTML = `<p class="text-center text-red-400 py-6">Błąd ładowania ostrzeżeń.</p>`;
            }
        }


        // Helper to format duration
        function formatDuration(seconds) {
            if (seconds === null || seconds === undefined) return 'N/A';
            if (seconds < 0) seconds = 0;

            const days = Math.floor(seconds / (3600 * 24));
            seconds %= (3600 * 24);
            const hours = Math.floor(seconds / 3600);
            seconds %= 3600;
            const minutes = Math.floor(seconds / 60);
            const remainingSeconds = seconds % 60;

            let parts = [];
            if (days > 0) parts.push(`${days}d`);
            if (hours > 0) parts.push(`${hours}h`);
            if (minutes > 0) parts.push(`${minutes}m`);
            if (remainingSeconds > 0 || parts.length === 0) parts.push(`${remainingSeconds}s`);

            return parts.join(' ');
        }


        function setupMobileMenu() {
            const mobileMenuButton = document.getElementById('mobileMenuButton');
            const mobileMenu = document.getElementById('mobileMenu');
            
            if (mobileMenuButton && mobileMenu) {
                mobileMenuButton.addEventListener('click', () => {
                    const isExpanded = mobileMenuButton.getAttribute('aria-expanded') === 'true' || false;
                    mobileMenuButton.setAttribute('aria-expanded', String(!isExpanded));
                    mobileMenu.classList.toggle('open');
                });
                mobileMenu.querySelectorAll('a').forEach(link => { 
                    link.addEventListener('click', () => {
                        mobileMenuButton.setAttribute('aria-expanded', 'false');
                        mobileMenu.classList.remove('open');
                    });
                });
            }
        }

        function setupRevealAnimations() {
            const revealObserver = new IntersectionObserver((entries, observer) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add('visible');
                        observer.unobserve(entry.target);
                    }
                });
            }, { threshold: 0.1 });

            document.querySelectorAll('.reveal').forEach(el => {
                revealObserver.observe(el);
            });
        }

        function setupDropdownDismiss() {
            window.addEventListener('click', function(e) {
                const desktopDropdownContainer = document.getElementById('userDropdownContainerNav');
                const mobileDropdownContainer = document.getElementById('userDropdownContainerMobile'); 
                const desktopDropdown = document.getElementById('userDropdownNav');
                const mobileDropdown = document.getElementById('userDropdownMobile'); 

                if (desktopDropdownContainer && !desktopDropdownContainer.contains(e.target) && desktopDropdown && desktopDropdown.classList.contains('open')) {
                    desktopDropdown.classList.remove('open');
                }
                if (mobileDropdownContainer && !mobileDropdownContainer.contains(e.target) && mobileDropdown && mobileDropdown.classList.contains('open')) {
                     mobileDropdown.classList.remove('open');
                }
            });
        }

        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('currentYear').textContent = new Date().getFullYear();
            
            if (!document.documentElement.classList.contains('light') && !document.documentElement.classList.contains('dark')) {
                 document.documentElement.classList.add('dark');
            }

            setActiveNavLink(); // Najpierw ustawiamy aktywne linki
            updateAuthDisplay(); // Następnie aktualizujemy UI logowania, co może załadować dane profilu
            setupMobileMenu();
            setupRevealAnimations();
            setupDropdownDismiss();
        });
    </script>
</body>
</html>
