<!DOCTYPE html>
<html lang="pl" class="scroll-smooth dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Zobacz artykuł na blogu Kronik Elary.">
    <meta name="author" content="Arcadius & Strażnicy Kronik Elary">
    <title>Artykuł - Kroniki Elary</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Lora:ital,wght@0,400;0,500;0,600;0,700;1,400;1,500;1,600&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-primary: #0F172A; --bg-secondary: rgba(30, 41, 59, 0.8); --bg-card: #1E293B; --bg-header: rgba(15, 23, 42, 0.92);
            --text-primary: #E2E8F0; --text-secondary: #94A3B8; --text-accent: #A78BFA; --text-accent-hover: #8B5CF6;
            --border-accent: #8B5CF6; --border-card: rgba(167, 139, 250, 0.25);
            --btn-primary-bg: #8B5CF6; --btn-primary-hover-bg: #7C3AED; --btn-discord-bg: #5865F2; --btn-discord-hover-bg: #4752C4;
            --scrollbar-thumb-bg: #8B5CF6; --scrollbar-thumb-hover-bg: #7C3AED; --svg-icon-fill: #E2E8F0;
            --shadow-color: rgba(167, 139, 250, 0.25); --shadow-strong-color: rgba(167, 139, 250, 0.4);
            --modal-backdrop: rgba(15, 23, 42, 0.85); --rgb-accent: 167, 139, 250;
        }
        html.light {
            --bg-primary: #F9FAFB; --bg-secondary: rgba(243, 244, 246, 0.9); --bg-card: #FFFFFF; --bg-header: rgba(255, 255, 255, 0.95);
            --text-primary: #1F2937; --text-secondary: #4B5563; --text-accent: #7C3AED; --text-accent-hover: #6D28D9;
            --border-accent: #7C3AED; --border-card: rgba(124, 58, 237, 0.1);
            --btn-primary-bg: #7C3AED; --btn-primary-hover-bg: #6D28D9; --btn-discord-bg: #5865F2; --btn-discord-hover-bg: #4752C4;
            --scrollbar-thumb-bg: #A78BFA; --scrollbar-thumb-hover-bg: #8B5CF6; --svg-icon-fill: #374151;
            --shadow-color: rgba(124, 58, 237, 0.08); --shadow-strong-color: rgba(124, 58, 237, 0.15);
            --modal-backdrop: rgba(249, 250, 251, 0.85); --rgb-accent: 124, 58, 237;
        }
        body { font-family: 'Inter', sans-serif; background-color: var(--bg-primary); color: var(--text-primary); transition: background-color 0.3s ease, color 0.3s ease; -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale; line-height: 1.75; }
        h1, h2, h3, h4, h5 { font-family: 'Lora', serif; font-weight: 600; line-height: 1.35; }
        h1 { letter-spacing: -0.025em; font-weight: 700; } h2 { letter-spacing: -0.02em; font-weight: 700; } h3 { font-weight: 600; }
        .text-accent { color: var(--text-accent); }
        header#navbar { background-color: var(--bg-header); backdrop-filter: blur(18px); transition: background-color 0.3s ease, box-shadow 0.3s ease; box-shadow: 0 5px 15px -4px rgba(15,23,42,0.2); }
        .nav-link { position: relative; color: var(--text-secondary); transition: color 0.2s ease, background-color 0.2s ease, transform 0.2s ease; padding: 0.65rem 1.1rem; border-radius: 0.6rem; font-weight: 500; }
        .nav-link:hover { transform: translateY(-1px); }
        .nav-link::after { content: ''; position: absolute; width: 0; height: 3px; bottom: 5px; left: 50%; transform: translateX(-50%); background-color: var(--text-accent); transition: width 0.35s cubic-bezier(0.25, 0.8, 0.25, 1); border-radius: 1.5px; }
        .nav-link:hover, .nav-link.active { color: var(--text-accent); background-color: rgba(var(--rgb-accent), 0.12); }
        .nav-link:hover::after, .nav-link.active::after { width: 60%; }
        #mobileMenu { transition: transform 0.4s cubic-bezier(0.25, 0.8, 0.25, 1), opacity 0.4s cubic-bezier(0.25, 0.8, 0.25, 1); transform: translateY(-100%); opacity: 0; pointer-events: none; }
        #mobileMenu.open { transform: translateY(0); opacity: 1; pointer-events: auto; }
        .user-avatar { width: 32px; height: 32px; border-radius: 50%; border: 2px solid var(--border-accent); cursor: pointer; transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out; }
        .user-avatar:hover { transform: scale(1.1); box-shadow: 0 0 10px var(--shadow-strong-color); }
        .dropdown-menu { position: absolute; top: calc(100% + 0.5rem); right: 0; background-color: var(--bg-card); border: 1px solid var(--border-card); border-radius: 0.5rem; box-shadow: 0 10px 25px -5px var(--shadow-strong-color), 0 8px 10px -6px var(--shadow-color); z-index: 50; min-width: 220px; opacity: 0; visibility: hidden; transform: translateY(-10px); transition: opacity 0.2s ease, transform 0.2s ease, visibility 0s linear 0.2s; }
        .dropdown-menu.open { opacity: 1; visibility: visible; transform: translateY(0); transition: opacity 0.2s ease, transform 0.2s ease; }
        .dropdown-menu a, .dropdown-menu button { display: block; width: 100%; text-align: left; padding: 0.75rem 1rem; font-size: 0.875rem; color: var(--text-secondary); transition: background-color 0.15s ease, color 0.15s ease; }
        .dropdown-menu a:hover, .dropdown-menu button:hover { background-color: rgba(var(--rgb-accent), 0.1); color: var(--text-accent); }
        .dropdown-menu form { margin: 0; }
        .loading-spinner { border-color: var(--text-accent) transparent var(--text-accent) transparent; }
        .article-content h2 { font-size: 1.75rem; margin-top: 2rem; margin-bottom: 1rem; color: var(--text-primary); }
        .article-content h3 { font-size: 1.5rem; margin-top: 1.75rem; margin-bottom: 0.75rem; color: var(--text-primary); }
        .article-content p { margin-bottom: 1.25rem; font-size: 1.05rem; line-height: 1.8; color: var(--text-secondary); }
        .article-content ul, .article-content ol { margin-left: 1.5rem; margin-bottom: 1.25rem; color: var(--text-secondary); }
        .article-content li { margin-bottom: 0.5rem; }
        .article-content a { color: var(--text-accent); text-decoration: underline; transition: color 0.2s ease; }
        .article-content a:hover { color: var(--text-accent-hover); }
        .article-content blockquote { border-left: 4px solid var(--border-accent); padding-left: 1rem; margin: 1.5rem 0; font-style: italic; color: var(--text-secondary); }
        .article-content pre { background-color: rgba(var(--rgb-accent), 0.05); padding: 1rem; border-radius: 0.5rem; overflow-x: auto; margin-bottom: 1.25rem; font-family: 'Courier New', Courier, monospace; font-size: 0.9rem; }
        .article-content code { background-color: rgba(var(--rgb-accent), 0.1); padding: 0.2em 0.4em; margin: 0 0.1em; border-radius: 0.25rem; font-family: 'Courier New', Courier, monospace; font-size: 0.9em; }
        .article-content pre code { background-color: transparent; padding: 0; margin: 0; }
        .article-content img { max-width: 100%; height: auto; border-radius: 0.5rem; margin: 1.5rem 0; box-shadow: 0 4px 12px var(--shadow-color); }
        .article-content hr { border-top: 1px solid var(--border-card); margin: 2.5rem 0; }
    </style>
</head>
<body class="antialiased">

    <header id="navbar" class="fixed top-0 left-0 right-0 z-50 py-3">
        <div class="container mx-auto px-4 sm:px-6 flex justify-between items-center">
            <a href="index.html" class="text-3xl font-bold" aria-label="Strona główna Kronik Elary">
                <span class="text-accent">Kroniki</span> <span class="text-primary">Elary</span>
            </a>
            <nav class="hidden md:flex items-center space-x-1 lg:space-x-2">
                <a href="index.html" class="nav-link">Strona Główna</a>
                <a href="prezentacja.html" class="nav-link">Prezentacja Serwera</a>
                <a href="wikipedia.html" class="nav-link">Wikipedia Kronik</a>
                <a href="blog.html" class="nav-link active">Blog</a>
                <a href="ranking-stats.html" class="nav-link">Rankingi</a>
                <a href="dom-aukcyjny.html" class="nav-link">Dom Aukcyjny</a>
                <div id="auth-section-nav" class="ml-4 relative"></div>
            </nav>
            <div class="md:hidden flex items-center">
                <div id="auth-section-mobile-nav" class="mr-2 relative"></div>
                <button id="mobileMenuButton" class="p-2 rounded-md focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-[var(--bg-header)] focus:ring-[var(--text-accent)]" aria-expanded="false" aria-controls="mobileMenu" aria-label="Otwórz menu nawigacyjne">
                    <svg class="w-6 h-6" fill="none" stroke="var(--svg-icon-fill)" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"></path></svg>
                </button>
            </div>
        </div>
        <div id="mobileMenu" class="absolute top-full left-0 right-0 md:hidden shadow-lg" style="background-color: var(--bg-header);">
            <div class="px-2 pt-2 pb-3 space-y-1 sm:px-3">
                <a href="index.html" class="block py-2.5 px-3 nav-link text-base font-medium">Strona Główna</a>
                <a href="prezentacja.html" class="block py-2.5 px-3 nav-link text-base font-medium">Prezentacja Serwera</a>
                <a href="wikipedia.html" class="block py-2.5 px-3 nav-link text-base font-medium">Wikipedia Kronik</a>
                <a href="blog.html" class="block py-2.5 px-3 nav-link text-base font-medium active">Blog</a>
                <a href="ranking-stats.html" class="block py-2.5 px-3 nav-link text-base font-medium">Rankingi</a>
                <a href="dom-aukcyjny.html" class="block py-2.5 px-3 nav-link text-base font-medium">Dom Aukcyjny</a>
                <a href="https://discord.gg/TWOJLINKZAPROSZENIOWY" target="_blank" rel="noopener noreferrer" class="block mt-2 py-2.5 px-3 text-base font-medium text-white bg-purple-600 hover:bg-purple-700 rounded-md text-center">Dołącz do Discorda</a>
            </div>
        </div>
    </header>

    <main class="pt-24 sm:pt-28 pb-16">
        <div class="container mx-auto px-4 sm:px-6 max-w-4xl">
            <div id="article-container" class="bg-bg-card p-6 sm:p-8 md:p-10 rounded-xl shadow-xl">
                {/* Artykuł będzie tutaj wstawiany przez JavaScript */}
            </div>
            <div id="loading-message-article" class="text-center py-20 text-secondary">
                <div class="animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 loading-spinner mx-auto mb-4"></div>
                Ładowanie artykułu...
            </div>
            <div id="error-message-article" class="hidden text-center py-20">
                <h2 class="text-2xl font-semibold text-red-400 mb-4">Błąd</h2>
                <p class="text-secondary mb-6">Nie udało się załadować artykułu lub artykuł nie istnieje. Spróbuj ponownie później lub wróć do listy artykułów.</p>
                <a href="blog.html" class="inline-block bg-accent hover:bg-accent-hover text-white font-semibold py-2 px-5 rounded-md transition-colors">Powrót do Bloga</a>
            </div>
             <div class="mt-10 text-center">
                <a href="blog.html" class="text-accent hover:text-accent-hover font-semibold text-sm">&larr; Powrót do listy artykułów</a>
            </div>
        </div>
    </main>

    <footer class="py-12 text-center" style="background-color: var(--bg-header);">
        <div class="container mx-auto px-4 sm:px-6">
            <div class="flex justify-center space-x-6 mb-6">
                 <a href="polityka-prywatnosci.html" class="text-secondary hover:text-accent transition-colors duration-200" aria-label="Polityka Prywatności">
                    Polityka Prywatności
                </a>
            </div>
            <p class="text-secondary text-sm">
                &copy; <span id="currentYear"></span> Kroniki Elary. Wszelkie prawa zastrzeżone.
            </p>
        </div>
    </footer>
    <script src="js/main.js" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/dompurify/3.0.8/purify.min.js" integrity="sha512-H+rglffZ6f5JvnrFnbqwkdnKOBK6I99CfA6EED2PYG0i2XfHPDhOBW9JWW2NfW9pdUqCwhKSoLgImY1hD/x77g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/9.1.5/marked.min.js" integrity="sha512-Q3K7ZgbB5KzEh0F9S4vN2QGg/1/6gL8bZj7n3D0l5PjBwW03R/0Bf1u/EIsHjk6WlT4fNlP7LXZgA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script>
        // Specific script for article-view.html
        const articleContainer = document.getElementById('article-container');
        const loadingMessageArticle = document.getElementById('loading-message-article');
        const errorMessageArticle = document.getElementById('error-message-article');

        async function fetchArticle() {
            const params = new URLSearchParams(window.location.search);
            const slug = params.get('slug');

            if (!slug) {
                loadingMessageArticle.style.display = 'none';
                errorMessageArticle.querySelector('p').textContent = 'Brak identyfikatora artykułu (slug) w adresie URL.';
                errorMessageArticle.style.display = 'block';
                return;
            }

            loadingMessageArticle.style.display = 'block';
            errorMessageArticle.style.display = 'none';
            articleContainer.innerHTML = '';

            try {
                const response = await fetch(`/api/articles/${slug}`);
                if (!response.ok) {
                    if (response.status === 404) {
                        throw new Error('ArticleNotFound');
                    }
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const article = await response.json();

                loadingMessageArticle.style.display = 'none';
                document.title = `${article.title} - Kroniki Elary`;
                const metaDesc = document.querySelector('meta[name="description"]');
                if (metaDesc) {
                    metaDesc.setAttribute('content', article.content.substring(0, 160).replace(/<[^>]*>?/gm, '') + '...');
                }

                let categoriesHTML = '';
                if (article.Categories && article.Categories.length > 0) {
                    categoriesHTML = `
                        <div class="mb-4 text-sm">
                            <strong>Kategorie:</strong>
                            ${article.Categories.map(cat => `<a href="blog.html?category=${cat.slug}" class="text-accent hover:underline mr-2">${cat.name}</a>`).join('')}
                        </div>
                    `;
                }

                const articleHTML = `
                    <img src="https://placehold.co/800x400/101A2B/A78BFA?text=${encodeURIComponent(article.title.substring(0,30))}" alt="Baner artykułu: ${article.title}" class="rounded-lg mb-6 sm:mb-8 w-full max-h-[400px] object-cover" onerror="this.onerror=null;this.src='https://placehold.co/800x400/0F172A/94A3B8?text=Brak+obrazka';">
                    <h1 class="text-3xl sm:text-4xl md:text-5xl font-bold text-primary mb-3">${article.title}</h1>
                    <p class="text-sm text-secondary mb-1">Autor: <span class="font-medium text-accent">${article.authorName}</span></p>
                    <p class="text-sm text-secondary mb-2">Opublikowano: ${new Date(article.publishedAt || article.createdAt).toLocaleDateString('pl-PL', { year: 'numeric', month: 'long', day: 'numeric', hour: '2-digit', minute: '2-digit' })}</p>
                    ${categoriesHTML}
                    <hr class="border-t border-[var(--border-card)] my-6 sm:my-8">
                    <div class="article-content prose prose-invert max-w-none text-lg leading-relaxed">
                        ${ DOMPurify.sanitize(marked.parse(article.content)) }
                    </div>
                `;
                articleContainer.innerHTML = articleHTML;

            } catch (error) {
                console.error('Błąd podczas pobierania artykułu:', error);
                loadingMessageArticle.style.display = 'none';
                if (error.message === 'ArticleNotFound') {
                    errorMessageArticle.querySelector('p').textContent = 'Artykuł o podanym adresie nie został znaleziony lub nie jest jeszcze opublikowany.';
                } else {
                    errorMessageArticle.querySelector('p').textContent = 'Wystąpił błąd podczas ładowania artykułu. Spróbuj ponownie później.';
                }
                errorMessageArticle.style.display = 'block';
                 document.title = "Nie znaleziono artykułu - Kroniki Elary";
            }
        }

        document.addEventListener('DOMContentLoaded', function() {
             if (typeof DOMPurify === 'undefined' || typeof marked === 'undefined') {
                console.warn("DOMPurify or Marked.js not loaded from CDN. Content rendering might be unsafe or incorrect if these are not globally available otherwise.");
                window.DOMPurify = window.DOMPurify || { sanitize: (html) => html };
                window.marked = window.marked || { parse: (markdown) => markdown };
            }
            fetchArticle();
        });
    </script>
</body>
</html>
